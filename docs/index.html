<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="sidb.html">sidb</a><ul class='methods'><li data-type='method'><a href="sidb.html#execTasks">execTasks</a></li><li data-type='method'><a href="sidb.html#getName">getName</a></li><li data-type='method'><a href="sidb.html#isIndexedDBavailable">isIndexedDBavailable</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="sidb_add.html">add</a><ul class='methods'><li data-type='method'><a href="sidb_add.html#index">index</a></li><li data-type='method'><a href="sidb_add.html#records">records</a></li><li data-type='method'><a href="sidb_add.html#store">store</a></li></ul></li><li><a href="sidb_get.html">get</a><ul class='methods'><li data-type='method'><a href="sidb_get.html#lastRecords">lastRecords</a></li><li data-type='method'><a href="sidb_get.html#records">records</a></li></ul></li><li><a href="sidb_remove.html">remove</a><ul class='methods'><li data-type='method'><a href="sidb_remove.html#db">db</a></li><li data-type='method'><a href="sidb_remove.html#index">index</a></li><li data-type='method'><a href="sidb_remove.html#records">records</a></li><li data-type='method'><a href="sidb_remove.html#store">store</a></li></ul></li><li><a href="sidb_update.html">update</a><ul class='methods'><li data-type='method'><a href="sidb_update.html#.records">records</a></li></ul></li><li><a href="sidb_utils.html">utils</a><ul class='methods'><li data-type='method'><a href="sidb_utils.html#pageFromArray">pageFromArray</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>SIDB (simple indexedDB)</h1><p>SIDB is a basic and very easy to use library wrapper for indexedDB.<br>IndexedDB is the recommended solution for the persistent storage of large volumes of structured data in the browser.<br>But, IndexedDB lacks a query language, is asynchronous and can be complex to manage.<br>SIDB adds an abstraction layer over indexedDB that hides that complexity.  </p>
<p>You can learn how to use SIDB in less than 5 minuts (or maybe 6 ;)).</p>
<h2>In this document ...</h2><hr>
<ul>
<li><a href="#Features">Features</a></li>
<li><a href="#Installation">Installation</a></li>
<li><a href="#Tutorial">Tutorial</a><ul>
<li><a href="#Database-structure-creation">Database structure creation</a></li>
<li><a href="#Insert-records">Insert records</a></li>
<li><a href="#Read-records">Read records</a></li>
<li><a href="#Update-records">Update records</a></li>
<li><a href="#Remove-records">Remove records</a></li>
</ul>
</li>
<li><a href="#Query-system">Query language</a></li>
<li><a href="#Using-functions">Using functions as values</a></li>
</ul>
<h2><a name="Features"></a>Features</h2><hr>
<ul>
<li>Task queue system that manages all asynchronous operations.</li>
<li>Natural and intuitive <a href="#Query-system">Query language</a>.</li>
<li>Simple and flexible methods to perform CRUD operations.</li>
<li>Insertion operations allow several entries to be entered at the same time.</li>
<li>Update operations accept <a href="#Using-functions">functions as value</a> to modify the current value of the record.</li>
<li>Lightweight. SIDB takes less than 20Kb minified and less than 3Kb compressed with gzip.</li>
<li>Default errorCallback in all methods. ErrorCallback parameter is optional.</li>
<li>Complete documentation with examples.</li>
</ul>
<h2><a name="Installation"></a>Installation</h2><hr>
<p>Download &quot;sidb.js&quot; or the minified version &quot;sidb.min.js&quot; from src folder to your proyect folder and add a reference in your html:</p>
<pre class="prettyprint source lang-html"><code>&lt;script src = &quot;sidb.js&quot;>&lt;/script></code></pre><h2><a name="Tutorial"></a>Tutorial</h2><hr>
<p>For the tutorial we will use an employees list from a supposed factory:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th style="text-align:left">Name</th>
<th style="text-align:left">Department</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Salary</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:left">Peter</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">32</td>
<td style="text-align:right">1200</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left">Paul</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">27</td>
<td style="text-align:right">1150</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:left">Adam</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">38</td>
<td style="text-align:right">1260</td>
</tr>
<tr>
<td>4</td>
<td style="text-align:left">Alice</td>
<td style="text-align:left">accounting</td>
<td style="text-align:right">41</td>
<td style="text-align:right">1400</td>
</tr>
<tr>
<td>5</td>
<td style="text-align:left">Alex</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">33</td>
<td style="text-align:right">1250</td>
</tr>
<tr>
<td>6</td>
<td style="text-align:left">Kathy</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">28</td>
<td style="text-align:right">1150</td>
</tr>
<tr>
<td>7</td>
<td style="text-align:left">David</td>
<td style="text-align:left">accounting</td>
<td style="text-align:right">32</td>
<td style="text-align:right">1380</td>
</tr>
</tbody>
</table>
<p>Each row represents a record. IndexedDB treats records as objects where each property represents a column.<br>These records are stored in an <strong>object store</strong>. The <strong>object store</strong> accepts objects of different types.<br>I could store other record without age column and with a lastName column.</p>
<p>The <strong>index</strong> is a subset of records from the object store that share the same property (<strong>keypath</strong>).<br>We could create at most an <strong>index</strong> for each property (column). The <strong>index</strong> order the records by its <strong>keypath</strong>.</p>
<h3><a name="Database-structure-creation"></a><strong>Database structure creation</strong></h3><pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate an sidb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
var mydb = new sidb('companyDB');


//
// We need to create at least one object store. 
// The object store is used to store the records (objects). It's similar to a table in a relational database.
// SIDB adds an autoincrement primary key (named &quot;nid&quot;) to each store.
// To create it we need the method add.store():
//
//     add.store( storeName, errorCallback)
//
// In this case one object store named &quot;southFactory&quot; is created.
// 
mydb.add.store('southFactory');


//
// It's a good idea to create one or more indexes for each store to order and filter the records (objects).
// The index keypath is the object property used to select and order the objects.
// Those objects that hasn't the index keypath as property will not be included in the index.
// Using an index we can avoid querying all the object store and losing performance.
// To create a new index we use add.index():
//
//     add.index( storeName, indexName, keyPath, errorCallback)
//
// In this case we create a single index named &quot;IDs&quot; with the keypath &quot;ID&quot;
//
mydb.add.index('southFactory', 'IDs', 'ID');



// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the function execTasks() to execute them.
//
mydb.execTasks();</code></pre><h3><a name="Insert-records"></a><strong>Insert records</strong></h3><p>With SIDB we can insert records individually or through an objects array.</p>
<pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate an sidb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
var mydb = new sidb('companyDB');


//
// To insert one or more records is used add.records():
//
//     add.records( storeName, obj, errorCallback)
//
// Inserts one record in &quot;southFactory&quot; object store.
//
mydb.add.records(
    'southFactory',                                                             // Object store name.
    {ID: 1, name: 'Peter', department: 'manufacturing', age: 32, salary: 1200}  // A single object that represents a record.
);


//
// Inserts 6 records in &quot;southFactory&quot; object store using an objects array.
//
mydb.add.records(
    'southFactory',
    [
        {ID: 2, name: 'Paul', department: 'manufacturing', age: 27, salary: 1150},
        {ID: 3, name: 'Adam', department: 'manufacturing', age: 38, salary: 1260},
        {ID: 4, name: 'Alice', department: 'accounting', age: 41, salary: 1400},
        {ID: 5, name: 'Alex', department: 'manufacturing', age: 33, salary: 1250},
        {ID: 6, name: 'Kathy', department: 'manufacturing', age: 28, salary: 1150},
        {ID: 7, name: 'David', department: 'accounting', age: 32, salary: 1380}
    ]
);


// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the function execTasks() to execute them.
//
mydb.execTasks();</code></pre><h3><a name="Read-records"></a><strong>Read records</strong></h3><p>SIDB can read the records using two methods and 5 types of query.</p>
<pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate an sidb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
var mydb = new sidb('companyDB');


//
// To get the last records we use get.lastRecords():
//
//     get.lastRecords( storeName, maxResults, succesCallback, errorCallback)
//
// Reads the 5 last records from &quot;southFactory&quot; object store.
// The third parameter is a function that will receive the result of the query.
//
mydb.get.lastRecords(
    'southFactory',         // Object store name
    5,                      // Max number of records retrieved
    readerCallback          // Function to handle the results
);


//
// With the second parameter null, reads all records from &quot;southFactory&quot; object store. 
//
mydb.get.lastRecords(
    'southFactory', 
    null, 
    readerCallback
);


//
// The method get.records() lets us use querys:
//
//     get.records( storeName, indexName, query, succesCallback, errorCallback)
//
// Gets the record with ID &quot;2&quot; from the index &quot;IDs&quot; in store &quot;southFactory&quot;.
// If you replace 'Adam' with null then the query sends all index records to the function readerCallback
//
mydb.get.records(
    'southFactory',         // Object store name
    'IDs',                  // Index name
    2,                      // Query. A single value refers to the index keyPath.
    readerCallback
);


//
// Gets employees records from manufacturing department with a salary higher than 1200.
// Here the third parameter (query) is an conditional expression that filters the records.
// The query can't be a single value if the index is null.
//
mydb.get.records(
    'southFactory', 
    null,
    'department = &quot;manufacturing&quot; & salary > 1200'
);


// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the function execTasks() to execute them.
//
mydb.execTasks();


//
// Simple function that receives the query result from SIDB methods and show it on console.
// The result received can be a single object or an object array. 
// 
//
function readerCallback(queryResult) {
    var i = 0;
    if(Array.isArray(queryResult)){
        for (i = 0; i &lt; queryResult.length; i++) {
            console.log(
             'ID: ' + queryResult[i].ID +
             'Name: ' + queryResult[i].name +
             'Department: ' + queryResult[i].department + 
             'Age: '+ queryResult[i].age +
             'Salary: '+ queryResult[i].salary
             );
        };
    } else {
        console.log(
         'ID: ' + queryResult.ID +
         'Name: ' + queryResult.name +
         'Department: ' + queryResult.department + 
         'Age: '+ queryResult.age +
         'Salary: '+ queryResult.salary
         );
    };
};</code></pre><h3><a name="Update-records"></a><strong>Update records</strong></h3><p>The method update.records() allows us to update the records in many ways.</p>
<pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate an sidb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
var mydb = new sidb('companyDB');


//
// We only need one method to update one or more records:
//
//     update.records( storeName, indexName, query, objectValues, errorCallback)
//
// This simple example changes the salary and age of an employee with ID 2 using the index 'IDs'.
//
mydb.update.records(
    'southFactory',             // Object store name
    'IDs',                      // Index name
    2,                          // Here the query is a single value that refers to the index keyPath
    {salary: 1290, age: 39},    // Object with the new values
    myErrorCallback             // Optional function to handle errors
);


//
// Updates the salary of all records where department is manufacturing and age > 30.
// Here a conditional expression is used as query. The index is null so all the store object is queried.
//
mydb.update.records(
    'southFactory',                                                     // Object store name
    null,                                                               // Index name is null so query can't be a single value
    'department = &quot;manufacturing&quot; & age > 30',                          // query
    {salary: 1300},                                                     // Object with the new values
    myErrorCallback                                                     // Optional function to handle errors
);


//
// The object values parameter accepts functions as value whose receives the old value an returns the new value.
// Here all salaries from employees with age highter than 40 or with salary less than 600, are increased by 300.
//
mydb.update.records(
    'southFactory',
    null,
    'age > 40 | salary &lt; 600',                                          // Query
    {salary: function(oldSalary){return oldSalary + 300;}},             // A function is used as new value
    myErrorCallback
);


//
// Example of a simple error callback
//
function myErrorCallback(event){
    console.log('Error updating records: ' + event.target.error);
};


// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the function execTasks() to execute them.
//
mydb.execTasks();</code></pre><h3><a name="Remove-records"></a><strong>Remove records</strong></h3><p>SIDB has the method remove.records() for this case.</p>
<pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate an sidb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
var mydb = new sidb('companyDB');


//
// To remove one or more records there is the method remove.records():
//
//     remove.records( storeName, indexName, query, errorCallback)
//
// For eample, this removes the record with ID 5 from the object store &quot;southFactory&quot;
//
mydb.remove.records(
    'southFactory',     // Object store name
    'IDs',              // Index name
    5,                  // Query. A single value refers to the index keypath.
    myErrorCallback     // Optional parameter. Function to handle errors.                     
);


//
// Removes all records from manufacturing department with salaries highter than 1200 or age highter than 60
//
mydb.remove.records(
    'southFactory',
    null,
    '(department=&quot;manufacturing&quot;) & (salary > 1200 | age > 60)'             // Query with 2 groups of conditions
);


// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the function execTasks() to execute them.
//
mydb.execTasks();</code></pre><h2><a name="Query-system"></a>Query language</h2><hr>
<p>Some SIDB methods receive as parameter to select records a string with an expression that represents the query.
Write a query is very intuitive. Is similar to write the condition in an &quot;if&quot; sentence.<br>A simple query would be: <code>recordProperty = value</code> 
There are some rules:</p>
<ul>
<li>You can use these comparisson operators:  <strong>=</strong> , <strong>&gt;</strong>, <strong>\&lt;</strong>, <strong>&gt;=</strong>, <strong>&lt;=</strong>, <strong>!=</strong></li>
<li>The valid logical operators are: <strong>&amp;</strong>, <strong>&amp;&amp;</strong>, <strong>|</strong>, <strong>||</strong></li>
<li><strong>&amp;</strong> (&quot;and&quot;) has same effect than <strong>&amp;&amp;</strong>, and the same to <strong>|</strong> (&quot;or&quot;) and <strong>||</strong>.</li>
<li>Only one type of logical operator can be used in a group of conditions. <pre class="prettyprint source lang-javascript"><code>salary > 1000 & name != 'Peter' & age > 34      // This is correct
salary > 1000 & name != 'Peter' | age > 34      // This is wrong</code></pre></li>
<li>Groups of conditions within other groups are not allowed.<pre class="prettyprint source lang-javascript"><code>(salary > 1000 & name != 'Peter') | (name = 'Adam' & salary &lt; 900)            // This is correct
((salary > 1000 & name != 'Peter') | ID = 5) | (name = 'Adam' & salary &lt; 900) // This is wrong</code></pre></li>
<li>Outside of a conditions Outside group there can't be another without parentheses.<pre class="prettyprint source lang-javascript"><code>(salary > 1000 & name != 'Peter') | (name = 'Adam')   // This is correct
(salary > 1000 & name != 'Peter') | name = 'Adam'     // This is wrong</code></pre></li>
<li>Only one type of logical operator can be used between groups of conditions<pre class="prettyprint source lang-javascript"><code>(a=2 & c&lt;10) | (d!=1) | (d=10 & e>=12)  // This is correct
(a=2 & c&lt;10) | (d!=1) & (d=10 & e>=12)  // This is wrong</code></pre></li>
<li>We can use a single value as a query when the value refers to the keypath of an existing index<pre class="prettyprint source lang-javascript"><code>mydb.remove.records(
  'southFactory',     // Object store name
  'IDs',              // Index name. Contains all objects with ID property in the object store &quot;southFactory&quot;
  5,                  // Query. A single value refers to the index keypath.
  myErrorCallback     // Optional parameter. Function to handle errors.                     
);</code></pre></li>
</ul>
<h2><a name="Using-functions"></a>Using functions as values</h2><hr>
<p>SIDB allows send a function in a query to modify records value.<br>To do this, we will consider the function as if it were the new value in the update.records() method.<br>This function will receive the current record value as a parameter and return the new value.</p>
<pre class="prettyprint source lang-javascript"><code>//
// The object values parameter accepts functions as value whose receives the old value an returns the new value.
// Here all salaries from manufacturing department are increased by 300.
//
mydb.update.records(
    'southFactory',
    null,
    'department = &quot;manufacturing&quot;',
    {salary: function(oldSalary){return oldSalary + 300;}},             // A function is used as new value
    myErrorCallback
);</code></pre></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Nov 07 2018 20:55:13 GMT+0100 (GMT+01:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>