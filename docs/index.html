<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Index_.html">Index</a><ul class='methods'><li data-type='method'><a href="Index_.html#aggregateFn">aggregateFn</a></li><li data-type='method'><a href="Index_.html#count">count</a></li><li data-type='method'><a href="Index_.html#get">get</a></li><li data-type='method'><a href="Index_.html#getAll">getAll</a></li></ul></li><li><a href="Store.html">Store</a><ul class='methods'><li data-type='method'><a href="Store.html#add">add</a></li><li data-type='method'><a href="Store.html#aggregateFn">aggregateFn</a></li><li data-type='method'><a href="Store.html#count">count</a></li><li data-type='method'><a href="Store.html#del">del</a></li><li data-type='method'><a href="Store.html#delIndex">delIndex</a></li><li data-type='method'><a href="Store.html#get">get</a></li><li data-type='method'><a href="Store.html#getAll">getAll</a></li><li data-type='method'><a href="Store.html#newIndex">newIndex</a></li><li data-type='method'><a href="Store.html#update">update</a></li></ul></li><li><a href="window.Sixdb.html">Sixdb</a><ul class='methods'><li data-type='method'><a href="window.Sixdb.html#customTask">customTask</a></li><li data-type='method'><a href="window.Sixdb.html#delStore">delStore</a></li><li data-type='method'><a href="window.Sixdb.html#destroy">destroy</a></li><li data-type='method'><a href="window.Sixdb.html#execTask">execTask</a></li><li data-type='method'><a href="window.Sixdb.html#name">name</a></li><li data-type='method'><a href="window.Sixdb.html#newStore">newStore</a></li><li data-type='method'><a href="window.Sixdb.html#openStore">openStore</a></li><li data-type='method'><a href="window.Sixdb.html#setCustomOperator">setCustomOperator</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="window.Sixdb.Sixdb_aggregateFuncs.html">Sixdb#aggregateFuncs</a><ul class='methods'><li data-type='method'><a href="window.Sixdb.Sixdb_aggregateFuncs.html#.avg">avg</a></li><li data-type='method'><a href="window.Sixdb.Sixdb_aggregateFuncs.html#.max">max</a></li><li data-type='method'><a href="window.Sixdb.Sixdb_aggregateFuncs.html#.min">min</a></li><li data-type='method'><a href="window.Sixdb.Sixdb_aggregateFuncs.html#.sum">sum</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1>SIXDB (simple indexedDB)</h1><p><img src="https://img.shields.io/github/tag-date/jjcapellan/sixdb.svg" alt="GitHub tag (latest by date)">
<img src="https://img.shields.io/github/size/jjcapellan/SIXDB/dist/sixdb.js.svg" alt="GitHub file size">
<img src="https://inch-ci.org/github/jjcapellan/SIXDB.svg?branch=master" alt="Docs status">
<img src="https://img.shields.io/github/license/jjcapellan/SIXDB.svg" alt="GitHub license"></p>
<p>SIXDB is a basic and very easy to use library wrapper for indexedDB.<br>IndexedDB is the recommended solution for the persistent storage of large volumes of structured data in the browser.<br>But, IndexedDB lacks a query language, is asynchronous and can be complex to manage.<br>SIXDB adds an abstraction layer over indexedDB that hides that complexity.  </p>
<p>You can learn how to use SIXDB in less than 5 minutes (or maybe 6 ;)).<br><strong>Complete SIXDB documentation available <a href="https://jjcapellan.github.io/SIXDB/">here</a></strong></p>
<h2>In this document ...</h2><hr>
<ul>
<li><a href="#Features">Features</a></li>
<li><a href="#Installation">Installation</a></li>
<li><a href="#Tutorial">Tutorial</a><ul>
<li><a href="#Database-structure-creation">Database structure creation</a></li>
<li><a href="#Insert-records">Insert records</a></li>
<li><a href="#Read-records">Read records</a></li>
<li><a href="#Update-records">Update records</a></li>
<li><a href="#Delete-records">Delete records</a></li>
</ul>
</li>
<li><a href="#Query-system">Query language</a></li>
<li><a href="#Custom-operator">Custom comparison operator</a></li>
<li><a href="#Using-functions">Using functions as values</a></li>
<li><a href="#Task-queue">The task queue</a></li>
<li><a href="#Error-handling">The SIXDB error handling</a></li>
<li><a href="#License">License</a></li>
</ul>
<h2><a name="Features"></a>Features</h2><hr>
<ul>
<li><a href="#Task-queue">Task queue</a> system that manages all asynchronous operations.</li>
<li>Natural and intuitive <a href="#Query-system">Query language</a>.</li>
<li>Simple and flexible methods to perform CRUD operations.</li>
<li>In addition to the predefined aggregate functions (sum, max, min, avg) you can use your own functions.</li>
<li>Insertion operations allow several entries to be entered at the same time.</li>
<li>Update operations accept <a href="#Using-functions">functions as value</a> to modify the current value of the record.</li>
<li>Lightweight. SIXDB takes less than 100Kb minified and less than 10Kb compressed with gzip.</li>
<li>Default errorCallback in all methods. ErrorCallback parameter is optional.</li>
<li>Complete <a href="https://jjcapellan.github.io/SIXDB/">documentation</a> with examples.</li>
</ul>
<h2><a name="Installation"></a>Installation</h2><hr>
<p>There are two alternatives:</p>
<ul>
<li>Download the file <a href="https://cdn.jsdelivr.net/gh/jjcapellan/SIXDB@3.0.0/dist/sixdb.js">sixdb.js</a> to your proyect folder and add a reference in your html:<pre class="prettyprint source lang-html"><code>&lt;script src = &quot;sixdb.js&quot;>&lt;/script></code></pre></li>
<li>Point a script tag to the CDN link:<pre class="prettyprint source lang-html"><code>&lt;script src = &quot;https://cdn.jsdelivr.net/gh/jjcapellan/SIXDB@3.0.0/dist/sixdb.js&quot;>&lt;/script></code></pre></li>
</ul>
<h2><a name="Tutorial"></a>Tutorial</h2><hr>
<p>For the tutorial we will use an employees list from a supposed factory:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th style="text-align:left">Name</th>
<th style="text-align:left">Department</th>
<th style="text-align:right">Age</th>
<th style="text-align:right">Salary</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:left">Peter</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">32</td>
<td style="text-align:right">1200</td>
</tr>
<tr>
<td>2</td>
<td style="text-align:left">Paul</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">27</td>
<td style="text-align:right">1150</td>
</tr>
<tr>
<td>3</td>
<td style="text-align:left">Adam</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">38</td>
<td style="text-align:right">1260</td>
</tr>
<tr>
<td>4</td>
<td style="text-align:left">Alice</td>
<td style="text-align:left">accounting</td>
<td style="text-align:right">41</td>
<td style="text-align:right">1400</td>
</tr>
<tr>
<td>5</td>
<td style="text-align:left">Alex</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">33</td>
<td style="text-align:right">1250</td>
</tr>
<tr>
<td>6</td>
<td style="text-align:left">Kathy</td>
<td style="text-align:left">manufacturing</td>
<td style="text-align:right">28</td>
<td style="text-align:right">1150</td>
</tr>
<tr>
<td>7</td>
<td style="text-align:left">David</td>
<td style="text-align:left">accounting</td>
<td style="text-align:right">32</td>
<td style="text-align:right">1380</td>
</tr>
</tbody>
</table>
<p>Each row represents a record. IndexedDB treats records as objects where each property represents a column.<br>These records are stored in an <strong>object store</strong>. The <strong>object store</strong> accepts objects of different types.<br>I could store other record without age column and with a lastName column.</p>
<p>The <strong>index</strong> is a subset of records from the object store that share the same property (<strong>keypath</strong>).<br>The <strong>index</strong> order the records by its <strong>keypath</strong>.</p>
<h3><a name="Database-structure-creation"></a><strong>Database structure creation</strong></h3><pre class="prettyprint source lang-javascript"><code>// First step is instantiate an SIXDB object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
const mydb = new Sixdb('companyDB');

// Now a store named &quot;southFactory&quot; with keyPath &quot;id&quot; and autoIncrement attribute activated is created.
// With this arguments, each new record added to store will receive a property &quot;id&quot; with a self-generated value.
// We need to create at least one store.
//
mydb.newStore(
    'southFactory',                            // Name of the new store.
    { keyPath: 'ID', autoIncrement: true }     // Optional object. Options are: keyPath, autoIncrement, successCallback, errorCallback.
);

// openStore() instantiates the new store. 
//
let myStore = mydb.openStore('southFactory');


//
// It's a good idea to create one or more indexes for each store to order the records (objects).
// The index keypath is the object property used to select and order the objects.
// Those objects that hasn't the index keypath as property will not be included in the index.
// The &quot;unique&quot; attribute prevents add two records with the same key. By default, &quot;unique&quot; is false.
//
// In this case we create a single index named &quot;Names&quot; with the keypath &quot;name&quot;. 
//
myStore.newIndex(
    'Names',            // Name of the new index.
    'name',             // Keypath.
    { unique: false}    // Optional object. Options are: unique, succesCallback, errorCallback.
);



// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the Sixdb method execTasks() to execute them.
//
mydb.execTasks();</code></pre><h3><a name="Insert-records"></a><strong>Insert records</strong></h3><p>With SIXDB we can insert records individually or through an objects array.</p>
<pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate a sixdb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
const mydb = new Sixdb('companyDB');

// Opens &quot;southFactory&quot; object store
//
let myStore = mydb.openStore('southFactory');


// Inserts one record in &quot;southFactory&quot; object store.
//
myStore.add(
    {name: 'Peter', department: 'manufacturing', age: 32, salary: 1200}    // A single object that represents a record.
);


//
// Inserts 6 records in &quot;southFactory&quot; object store using an objects array.
//
myStore.add(
    'southFactory',
    [
        { name: 'Paul', department: 'manufacturing', age: 27, salary: 1150},
        { name: 'Adam', department: 'manufacturing', age: 38, salary: 1260},
        { name: 'Alice', department: 'accounting', age: 41, salary: 1400},
        { name: 'Alex', department: 'manufacturing', age: 33, salary: 1250},
        { name: 'Kathy', department: 'manufacturing', age: 28, salary: 1150},
        { name: 'David', department: 'accounting', age: 32, salary: 1380}
    ]
);


// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the Sixdb method execTasks() to execute them.
//
mydb.execTasks();</code></pre><h3><a name="Read-records"></a><strong>Read records</strong></h3><p>SIXDB can read the records using the Store or the Index objects.<br>The Index sorts the results by its keypath and the Store uses its primary key.<br>Store and Index objects have the methods <strong>get()</strong> and <strong>getAll()</strong>.</p>
<pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate an sixdb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
const mydb = new Sixdb('companyDB');

// Opens &quot;southFactory&quot; store
//
let myStore = mydb.openStore('southFactory');

// Opens &quot;Names&quot; index
//
let myIndex = myStore.openIndex('Names');


// Gets all records in the store. Gets the records sorted by the store primary key (&quot;ID&quot;).
myStore.getAll(succesCallback);

// Gets all records in the index. Gets the records sorted by the index keypath (&quot;name&quot;).
myIndex.getAll(successCallback);

// Gets the record with primary key (&quot;ID&quot;) 4 from the store. Single value in first parameter refers to the keypath.
//
myStore.get(
    4,                 // The query.
    successCallback    // Success callback wich receives the result.
);

// Gets records from manufacturing department with salary > 1200.
//
myStore.get('department = manufacturing & salary > 1200', successCallback);


// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the Sixdb method execTasks() to execute them.
//
mydb.execTasks();


//
// Simple function that receives the uery result from SIXDB methods and show it on console.
// The result received can be a single object or an object array. 
// 
//
function successCallback(result) {
    if(Array.isArray(result)){
        for (let i = 0, j = result.length; i &lt; j; i++) {
            console.log(
             `Name: ${result[i].name}\n` +
             `Department: ${result[i].department}\n` + 
             `Age: ${result[i].age}\n` +
             `Salary: ${result[i].salary}\n`
             );
        }
    } else {
        console.log(
         `Name: ${result[i].name}\n` +
         `Department: ${result[i].department}\n` + 
         `Age: ${result[i].age}\n` +
         `Salary: ${result[i].salary}\n`
         );
    }
}</code></pre><h3><a name="Update-records"></a><strong>Update records</strong></h3><p>The Store method <strong>update()</strong> allows us to update the records in many ways.</p>
<pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate an sixdb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
const mydb = new Sixdb('companyDB');

// Opens &quot;southFactory&quot; store
//
let myStore = mydb.openStore('southFactory');

// This simple example changes the salary and age of the employee with ID 2.
//
myStore.update(
    2,                                  // The query.
    {salary: 1290, age: 39},            // Object with the new values.
    {errorCallback: myErrorCallback}    // Optional object. Options are: successCallback, errorCallback.
);

// Updates the salary of all records where department is manufacturing and age > 30 to a new salary of 1300.
//
myStore.update(
    'department = &quot;manufacturing&quot; & age > 30',    // The query
    {salary: 1300},                               // Object with the new values
    {errorCallback: myErrorCallback }             // Optional object.
);

// The object values parameter accepts functions as value whose receives the old value an returns the new value.
// Here all salaries from employees with age highter than 40 or with salary less than 600, are increased by 300.
//
myStore.update(
    'age > 40 | salary &lt; 600',
    {salary: function(oldSalary) { return oldSalary + 300;} },           // A function is used as new value for salary.
    {errorCallback: myErrorCallback}
);

// Simple error callback
//
function myErrorCallback(e){
    console.error(e);
};


// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the Sixdb method execTasks() to execute them.
//
mydb.execTasks();</code></pre><h3><a name="Delete-records"></a><strong>Delete records</strong></h3><p>Store object uses the method <strong>del()</strong> for delete one or more records.</p>
<pre class="prettyprint source lang-javascript"><code>//
// First step is instantiate an sixdb object, it checks if already exists a database called &quot;companyDB&quot; (If doesn't, a new one is created).
//   
const mydb = new Sixdb('companyDB');

// Opens &quot;southFactory&quot; store
//
let myStore = mydb.openStore('southFactory');

// Deletes the record with ID 5 from the object store &quot;southFactory&quot;.
//
myStore.del(
    5,                                  // Query. A single value refers to the primary key.
    {errorCallback: myErrorCallback}    // Optional object. Options are: successCallback, errorCallback.            
);

// deletes all records from manufacturing department with salaries highter than 1200 or age highter than 60
//
myStore.del(
    '(department = manufacturing) & (salary > 1200 | age > 60)'             // Query with 2 groups of conditions
);

// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the Sixdb method execTasks() to execute them.
//
mydb.execTasks();</code></pre><h2><a name="Query-system"></a><strong>Query language</strong></h2><hr>
<p>Some SIXDB methods receive as parameter to select records a string with an expression that represents the query.
Write a query is very intuitive. Is similar to write the condition in an &quot;if&quot; sentence.<br>A simple query would be: <code>recordProperty = value</code> 
There are some rules:</p>
<ul>
<li>You can use these normal comparisson operators:  <strong>=</strong> , <strong>&gt;</strong>, <strong>\&lt;</strong>, <strong>&gt;=</strong>, <strong>&lt;=</strong>, <strong>!=</strong></li>
<li>There are too &quot;special&quot; operators:<ul>
<li><strong>&lt;&gt;</strong>   : &quot;Contains&quot; operator. Valid for strings.<pre class="prettyprint source lang-javascript"><code>name &lt;> ul // The property name contains the substring &quot;ul&quot;. (quotes are optional)</code></pre></li>
<li><strong>^</strong>    : &quot;Starts with&quot; operator. Valid for strings. Is case sensitive.<pre class="prettyprint source lang-javascript"><code>name ^ Pe // Means the property name starts with the substring &quot;Pe&quot; (quotes are optional).</code></pre></li>
</ul>
</li>
<li>The valid logical operators are: <strong>&amp;</strong>, <strong>&amp;&amp;</strong>, <strong>|</strong>, <strong>||</strong></li>
<li><strong>&amp;</strong> (&quot;and&quot;) has same effect than <strong>&amp;&amp;</strong>, and the same to <strong>|</strong> (&quot;or&quot;) and <strong>||</strong>.</li>
<li>Only one type of logical operator can be used in a group of conditions. <pre class="prettyprint source lang-javascript"><code>salary > 1000 & name != 'Peter' & age > 34      // This is correct
salary > 1000 & name != 'Peter' | age > 34      // This is wrong</code></pre></li>
<li>Groups of conditions within other groups are not allowed.<pre class="prettyprint source lang-javascript"><code>(salary > 1000 & name != 'Peter') | (name = 'Adam' & salary &lt; 900)            // This is correct
((salary > 1000 & name != 'Peter') | ID = 5) | (name = 'Adam' & salary &lt; 900) // This is wrong</code></pre></li>
<li>Outside of a conditions group there can't be another without parentheses.<pre class="prettyprint source lang-javascript"><code>(salary > 1000 & name != 'Peter') | (name = 'Adam')   // This is correct
(salary > 1000 & name != 'Peter') | name = 'Adam'     // This is wrong</code></pre></li>
<li>Only one type of logical operator can be used between groups of conditions<pre class="prettyprint source lang-javascript"><code>(a = 2 & c &lt; 10) | (d != 1) | (d = 10 & e >= 12)  // This is correct
(a = 2 & c &lt; 10) | (d != 1) & (d = 10 & e >= 12)  // This is wrong</code></pre></li>
<li>A single value refers to a keypath<pre class="prettyprint source lang-javascript"><code>myStore.del(
  5,                                  // Query. A single value refers to the primary key.
  {errorCallback: myErrorCallback}    // Optional object. Options are: successCallback, errorCallback.            
);</code></pre></li>
<li>Spaces or symbols in the value of a condition must be enclosed in quotation marks. Parentheses and nested quotes are not supported.<pre class="prettyprint source lang-javascript"><code>name = 'John Smith'                 // This is correct
equation = 'e = v / t'              // This is correct
equation = e = v / t                // This is wrong. The query system can't parse that &quot;=&quot; without quotes.
message = 'This is my &quot;message&quot;'    // This is wrong.
message = 'This (is) my message'    // This is wrong.</code></pre></li>
</ul>
<h2><a name="Custom-operator"></a><strong>Custom comparison operator</strong></h2><hr>
<p>We can create our own operator to use in the queries.<br>The custom operator is represented in the query system with &quot;~~&quot;.<br>To get it we must make a compare function and set the customOperator variable.<br>By default &quot;~~&quot; acts like &quot;=&quot;.</p>
<pre class="prettyprint source lang-javascript"><code>//
// The compare function must have two arguments, property value and test value. If this function triggers
// an error exception then the query system returns the condition result as false.
// In this example the function returns true when the length of property and test value is equal.
//
const compareFunction = function(propValue, testValue){
    return propValue.length == testValue.length;
};

// Assigns compareFunction to the customOperator variable
//
mydb.setCustomOperator(compareFunction);</code></pre><h2><a name="Using-functions"></a><strong>Using functions as values</strong></h2><hr>
<p>SIXDB allows send a function in a query to modify records value.<br>To do this, we will consider the function as if it were the new value in the update.records() method.<br>This function will receive the current record value as a parameter and return the new value.</p>
<pre class="prettyprint source lang-javascript"><code>// The object values parameter accepts functions as value whose receives the old value an returns the new value.
// Here all salaries from employees with age highter than 40 or with salary less than 600, are increased by 300.
//
myStore.update(
    'age > 40 | salary &lt; 600',
    {salary: function(oldSalary) { return oldSalary + 300;} },           // A function is used as new value for salary.
    {errorCallback: myErrorCallback}
);</code></pre><h2><a name="Task-queue"></a><strong>The SIXDB task queue</strong></h2><hr>
<p>SIXDB is based on a <strong>task queue</strong> to manage the creation, insertion, reading, and deletion orders.<br>The task queue is a list that uses the method FIFO (first in first out) to decide which task is executed.<br>When a task finishes it is deleted from the list and the queue is checked to execute pending tasks.<br>The result is that the orders are executed sequentially.<br>The Sixdb method <strong>customTask()</strong> allows us to add our own task to the queue. 
Here a quick example:</p>
<pre class="prettyprint source lang-Javascript"><code>let mydb = new Sixdb('companyDB');

let myStore = mydb.openStore('southFactory');

// Inserts one record in &quot;southFactory&quot; object store.
//
myStore.add(
    {name: 'Peter', department: 'manufacturing', age: 32, salary: 1200}  // A single object that represents a record.
);


// Our function is executed after the previous insertion task and before the next reading task.
//
mydb.add.customTask(
    function(m){                                // Custom function
        alert(m);
    },
    this,                                       // Context. Usually &quot;this&quot;.
    'Inserting operation finished !!'           // Arguments of the function. Can be a variable number of arguments.
)



// Reads all records from &quot;southFactory&quot; object store.
//
myStore.getAll(readerCallback);


// ***** VERY IMPORTANT ****
// Once we have introduced the operations that we want to perform on the database, 
// we must use the Sixdb method execTasks() to execute them.
//
mydb.execTasks();</code></pre><h2><a name="Error-handling"></a><strong>The SIXDB error handling</strong></h2><p>By default all errors are catched and hanled by a basic function that sends the error object to console and prevents an exception to stop the execution of the task queue.<br>When an error is captured, the transaction is closed, the current task is stopped and the next one is started.<br>The error callbacks reciebe an error object.<br>The error object has this properties:</p>
<ul>
<li>type: {string} Type of error.</li>
<li>origing: {string} Function where the error occurred.</li>
<li>description: {string} More detailed info about the error.</li>
</ul>
<h2><a name="License"></a><strong>License</strong></h2><p>SIXDB is licensed under the terms of the MIT open source license.</p></article>
    </section>






</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Dec 10 2018 18:56:09 GMT+0100 (GMT+01:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>