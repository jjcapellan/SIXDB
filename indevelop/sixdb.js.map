{"version":3,"file":"sixdb.js","sources":["../src/qrySys.js","../src/taskQueue.js","../src/logger.js","../src/sixdbStore.js","../src/sixdbIndex.js","../src/errorSys.js","../src/sixdb.js","../src/helpers.js","../src/index.js"],"sourcesContent":["//import { customOperator } from './index.js';\n\nexport const _qrySys = {\n  init() {\n    this.blockRgx = /\\(.*?(?=\\))/g;\n    this.blockOperatorRgx = /[\\&\\|]+(?=(\\s*\\())/g;\n    this.operatorRgx = /(=|>|<|>=|<=|!=|<>|\\^|\\$|~~)+/g;\n    this.rightOperandRgx = /(?:([=><\\^\\$~]))\\s*[\"']?[^\"']+[\"']?\\s*(?=[&\\|])|(?:[=><\\^\\$~])\\s*[\"']?[^\"']+[\"']?(?=$)/g;\n    this.leftOperandRgx = /([^\"'\\s])(\\w+)(?=\\s*[=|>|<|!|\\^|\\$~])/g;\n  },\n\n  makeConditionsBlocksArray(query) {\n    let t = this;\n    let conditionsBlocksArray = [];\n\n    //// Gets blocks\n    //\n    let blocks = query.match(t.blockRgx);\n\n    // Logical operators between blocks, all must be the same type\n    let extLogOperator = query.match(t.blockOperatorRgx)\n      ? query.match(t.blockOperatorRgx)\n      : null;\n\n    // If condition is a single sentence like: \" a = 10 & b > 5 \"\n    if (!blocks) {\n      t.pushConditionBlockToArray(query, null, conditionsBlocksArray);\n      return conditionsBlocksArray;\n    }\n\n    // Delete left parentheses\n    t.deleteLeftParentheses(blocks);\n\n    // If condition is a multiple sentence like: \" (a = 5 & b = 10) || (c < 4 & f > 10) \"\n    if (extLogOperator) {\n      if (extLogOperator == '&' || extLogOperator == '&&') {\n        extLogOperator = 'and';\n      } else {\n        extLogOperator = 'or';\n      }\n    }\n\n    for (let i = 0; i < blocks.length; i++) {\n      t.pushConditionBlockToArray(blocks[i], extLogOperator, conditionsBlocksArray);\n    }\n    return conditionsBlocksArray;\n  },\n\n  deleteLeftParentheses(blocks) {\n    let size = blocks.length;\n    for (let i = 0; i < size; i++) {\n      blocks[i] = blocks[i].substr(1);\n    }\n  },\n\n  pushConditionBlockToArray(query, extLogOperator, conditionsBlocksArray) {\n    let t = this;\n    let leftOperands = query.match(t.leftOperandRgx);\n    let rightOperands = query.match(t.rightOperandRgx);\n\n    for (let i = 0; i < rightOperands.length; i++) {\n      // Delete the operator\n      while (rightOperands[i][0].match(/[=><!\\^\\$~]/g)) {\n        rightOperands[i] = rightOperands[i].substr(1);\n      }\n      // Delete quotes and trim white spaces\n      rightOperands[i] = rightOperands[i].replace(/[\"']/g, '').trim();\n    }\n\n    //// Gets operators\n    //// Removing righ operands (values) before extract comparison operators avoids\n    //// problems with literal values that include comparisson symbols(= , >,...) quoted.\n    //\n    for (let i = 0; i < rightOperands.length; i++) {\n      query = query.replace(rightOperands[i], '');\n    }\n    let operators = query.match(t.operatorRgx);\n\n    let conditionsArray = [];\n\n    // If query is like: \" c = 15 \"\n    if (leftOperands.length == 1) {\n      //{property, operator (=,>,<, ...), value}\n      conditionsArray.push({\n        keyPath: leftOperands[0],\n        cond: operators[0],\n        value: rightOperands[0]\n      });\n\n      conditionsBlocksArray.push({\n        conditionsArray: conditionsArray,\n        internalLogOperator: null,\n        externalLogOperator: extLogOperator\n      });\n\n      conditionsArray = null;\n    } else {\n      // if query is like: \" c = 15 & a > 30 \"\n      let logOperatorsType = query.match(/[\\&\\|]+/g)[0];\n\n      if (logOperatorsType == '&' || logOperatorsType == '&&') {\n        logOperatorsType = 'and';\n      } else {\n        logOperatorsType = 'or';\n      }\n\n      for (let i = 0; i < operators.length; i++) {\n        conditionsArray.push({\n          keyPath: leftOperands[i],\n          cond: operators[i],\n          value: rightOperands[i]\n        });\n      }\n\n      conditionsBlocksArray.push({\n        conditionsArray: conditionsArray,\n        internalLogOperator: logOperatorsType,\n        externalLogOperator: extLogOperator\n      });\n      conditionsArray = null;\n    } // end if else\n  },\n\n  testConditionBlock(cursor, conditionsArray, operator) {\n    let t = this;\n\n    let test = operator == 'and' || !operator ? true : false;\n    for (let i = 0; i < conditionsArray.length; i++) {\n      test = t.testCondition(\n        cursor.value[conditionsArray[i].keyPath],\n        conditionsArray[i].cond,\n        conditionsArray[i].value\n      );\n      if ((operator == 'and' || !operator) && !test) return false;\n      else if (operator == 'or' && test) return true;\n    }\n\n    return test;\n  },\n\n  testCondition(value1, condition, value2) {\n    let result;\n    switch (condition) {\n      case '=':\n        result = value1 == value2 ? true : false;\n        break;\n\n      case '>':\n        result = value1 > value2 ? true : false;\n        break;\n\n      case '<':\n        result = value1 < value2 ? true : false;\n        break;\n\n      case '>=':\n        result = value1 >= value2 ? true : false;\n        break;\n\n      case '<=':\n        result = value1 <= value2 ? true : false;\n        break;\n\n      case '!=':\n        result = value1 != value2 ? true : false;\n        break;\n\n      case '<>': // string value1 contains substring value2\n        if (typeof value1 != 'string') {\n          return false;\n        }\n        result = value1.indexOf(value2) != -1;\n        break;\n\n      case '^':\n        if (typeof value1 != 'string') {\n          return false;\n        }\n        result = value1.indexOf(value2) == 0;\n        break;\n\n      case '$':\n        if (typeof value1 != 'string') {\n          return false;\n        }\n        result = value1.indexOf(value2) == value1.length - value2.length;\n        break;\n\n      case '~~': //custom operator\n        try {\n          result = customOperator(value1, value2);\n        } catch (e) {\n          result = false;\n        }\n        break;\n\n      default:\n        break;\n    }\n    return result;\n  }\n};\n","import { logEnum, logger } from './index.js';\n\nlet idle = true;\nexport let tasks = [];\n\nexport function checkTasks() {\n  if (tasks.length == 0) {\n    idle = true;\n    logger('No pending tasks');\n    return;\n  }\n  idle = false;\n  let task = tasks[0];\n  if (!task.type) {\n    task.fn.apply(this, task.args);\n  } else {\n    logger('Custom task' + logEnum.begin);\n    task.fn.apply(task.context, task.args);\n    done();\n  }\n}\n\nexport function done() {\n  tasks.shift();\n  checkTasks();\n}\n\nexport function execTasks() {\n  if (idle) {\n    checkTasks();\n  }\n}\n","//import { consoleOff } from './index.js';\n\nexport const logEnum = {\n  begin: '//--------------------------------------->'\n};\n\nexport function logger(message, isError) {\n  if (consoleOff && !isError) return;\n\n  if (!isError) console.log(message);\n  else console.error(message);\n}\n","import {\n  _qrySys,\n  aggregateLog,\n  checkTasks,\n  countLog,\n  cursorAggregate,\n  cursorCount,\n  cursorDelRecords,\n  cursorGetRecords,\n  cursorLoop,\n  cursorUpdate,\n  db,\n  dbName,\n  done,\n  Index,\n  initCursorLoop,\n  isKey,\n  lastErrorObj,\n  logEnum,\n  logger,\n  makeErrorObject,\n  queryLog,\n  requestErrorAction,\n  requestSuccessAction,\n  setDb,\n  setSharedObj,\n  tasks,\n  tkOpen,\n  tryGetAll,\n  tryGetByKey,\n  tryOpenCursor,\n  voidFn,\n} from './index.js';\n\n//// Private variables //////////////////////////////\nlet _store;\nconst qrySys = _qrySys;\n\nfunction setStore(storeName, rwMode) {\n  _store = null;\n  let origin = 'initStore()';\n  try {\n    _store = db.transaction(storeName, rwMode).objectStore(storeName);\n  } catch (e) {\n    makeErrorObject(origin, e);\n    logger(lastErrorObj, true);\n  }\n  done();\n}\n\n// Puts setStore() in task queue\nfunction initStore(storeName, rwMode) {\n  let args = [storeName, rwMode];\n  let task = {\n    args: args,\n    fn: setStore\n  };\n\n  tasks.push(task);\n}\n\n//// Private functions //////////////////////////////\n\n// Creates a new index in the store\nfunction newIndex(\n  storeName,\n  indexName,\n  keyPath,\n  { unique, successCallback = voidFn, errorCallback = voidFn } = {}\n) {\n  let version;\n  let origin = 'Store.newIndex()';\n  logger(origin + logEnum.begin);\n\n  //checks if index exists\n  let transaction = db.transaction(storeName);\n  if (transaction.objectStore(storeName).indexNames.contains(indexName)) {\n    console.log('activated');\n    requestSuccessAction(\n      null,\n      origin,\n      successCallback,\n      `The index \"${indexName}\" already exists in store \"${storeName}\"`\n    );\n    return;\n  }\n\n  //// Gets the new version\n  //\n  version = db.version;\n  db.close();\n  let newVersion = version + 1;\n\n  //// The change of the database schema only can be performed in the onupgradedneeded event\n  //// so a new version number is needed to trigger that event.\n  //\n  let request = window.indexedDB.open(dbName, newVersion);\n\n  request.onupgradeneeded = function (event) {\n    let _db = event.target.result;\n    setDb(_db);\n    let _store = null;\n\n    var upgradeTransaction = event.target.transaction;\n\n    //// Gets store\n    try {\n      _store = upgradeTransaction.objectStore(storeName);\n      _store.createIndex(indexName, keyPath);\n    } catch (e) {\n      requestErrorAction(origin, e, errorCallback);\n      return;\n    }\n  };\n\n  request.onsuccess = function (event) {\n    requestSuccessAction(\n      event,\n      origin,\n      successCallback,\n      `Index \"${indexName}\" created in store \"${storeName}\"`\n    );\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\n// Adds one(A) or more(B) records to the store\nfunction addRecord(obj, { successCallback = voidFn, errorCallback = voidFn }) {\n  let origin = 'Store.add()';\n  logger(origin + logEnum.begin);\n  let args = { obj, origin, successCallback, errorCallback };\n\n  if (Array.isArray(obj)) {\n    addRecordA(args);\n  } else {\n    addRecordB(args);\n  }\n}\nfunction addRecordA({ obj, origin, successCallback, errorCallback }) {\n  let objSize = obj.length;\n  let counter = 0;\n\n  while (counter < objSize) {\n    let request = _store.add(obj[counter]);\n    counter++;\n    request.onerror = function () {\n      requestErrorAction(origin, request.error, errorCallback);\n    };\n  }\n  requestSuccessAction(\n    event,\n    origin,\n    successCallback,\n    `New record/s added to store \"${_store.name}\"`\n  );\n}\nfunction addRecordB({ obj, origin, successCallback, errorCallback }) {\n  let request = _store.add(obj);\n  request.onsuccess = function (event) {\n    requestSuccessAction(\n      event,\n      origin,\n      successCallback,\n      `New record/s added to store \"${_store.name}\"`\n    );\n  };\n\n  request.onerror = function (event) {\n    requestErrorAction(origin, event.target.error, errorCallback);\n  };\n}\n// Gets all records from a store\nfunction getAll(successCallback, errorCallback) {\n  let request = null;\n  let origin = 'Store.getAll()';\n  logger(origin + logEnum.begin);\n\n  /// Callbacks of request\n  let onsuccess = function (event) {\n    requestSuccessAction(\n      event.target.result,\n      origin,\n      successCallback,\n      `All records returned from store \"${_store.name}\"`\n    );\n  };\n  let onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n\n  /// Request definition\n  request = tryGetAll(origin, _store, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n  request.onsuccess = onsuccess;\n  request.onerror = onerror;\n}\n// Gets records filtered by a query\nfunction get(query, successCallback, errorCallback) {\n  let origin = 'Store.get()';\n  logger(origin + logEnum.begin);\n  if (isKey(query)) {\n    getBykey(query, successCallback, errorCallback);\n    return;\n  }\n  let resultFiltered = [];\n  let conditionsBlocksArray = qrySys.makeConditionsBlocksArray(query);\n\n  let extMode = conditionsBlocksArray\n    ? conditionsBlocksArray[0].externalLogOperator\n    : null;\n\n  let exitsInFirstTrue = extMode == null || extMode == 'and' ? false : true;\n  let obj = {\n    counter: 0,\n    source: _store.name,\n    extMode: extMode,\n    event: resultFiltered,\n    resultFiltered: resultFiltered,\n    origin: origin,\n    query: query,\n    conditionsBlocksArray: conditionsBlocksArray,\n    exitsInFirstTrue: exitsInFirstTrue,\n    logFunction: queryLog,\n    cursorFunction: cursorGetRecords,\n    successCallback: successCallback\n  };\n\n  setSharedObj(obj);\n\n  let request = tryOpenCursor(origin, _store, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n\n  request.onsuccess = function (event) {\n    let cursor = event.target.result;\n    cursorLoop(cursor);\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n// Gets records with key as query\nfunction getBykey(query, successCallback, errorCallback) {\n  let origin = 'Store.getByKey()';\n  logger(origin + logEnum.begin);\n  let request;\n\n  let onsuccess = function (event) {\n    successCallback(event.target.result, origin, query);\n    db.close();\n    logger(`Records with key \"${query}\" returned from store \"${_store.name}\"`);\n    done();\n  };\n  let onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n\n  request = tryGetByKey(origin, _store, query, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n  request.onsuccess = onsuccess;\n  request.onerror = onerror;\n}\n// Deletes one or more records using a query\nfunction del(query, successCallback, errorCallback) {\n  let origin = 'Store.del()';\n  logger(origin + logEnum.begin);\n\n  if (isKey(query)) {\n    delByKey(query, successCallback, errorCallback);\n    return;\n  }\n\n  let request = null;\n\n  let conditionsBlocksArray = qrySys.makeConditionsBlocksArray(query);\n  let extMode = conditionsBlocksArray\n    ? conditionsBlocksArray[0].externalLogOperator\n    : null;\n  let exitsInFirstTrue = extMode == null || extMode == 'and' ? false : true;\n\n  let obj = {\n    counter: 0,\n    extMode: extMode,\n    source: _store.name,\n    event: event,\n    origin: origin,\n    query: query,\n    conditionsBlocksArray: conditionsBlocksArray,\n    exitsInFirstTrue: exitsInFirstTrue,\n    logFunction: queryLog,\n    cursorFunction: cursorDelRecords,\n    successCallback: successCallback\n  };\n\n  setSharedObj(obj);\n\n  request = tryOpenCursor(origin, _store, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n\n  request.onsuccess = function (event) {\n    let cursor = event.target.result;\n    cursorLoop(cursor);\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n// Deletes records using primary key as query. Is more fast.\nfunction delByKey(query, successCallback, errorCallback) {\n  let origin = 'Store.delByKey()';\n  logger(origin + logEnum.begin);\n\n  let request = _store.delete(query);\n\n  request.onsuccess = function (event) {\n    successCallback(event, origin, query);\n    db.close();\n    logger(`Records with primary key \"${query}\" deleted from store \"${_store.name}\"`);\n    done();\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n// Counts records filtered by a query\nfunction count(query, successCallback, errorCallback) {\n  let origin = 'Store.count()';\n  logger(origin + logEnum.begin);\n\n  if (!query) {\n    countAll(successCallback, errorCallback);\n    return;\n  }\n\n  let conditionsBlocksArray = qrySys.makeConditionsBlocksArray(query);\n  let extMode = conditionsBlocksArray\n    ? conditionsBlocksArray[0].externalLogOperator\n    : null;\n  let exitsInFirstTrue = extMode == null || extMode == 'and' ? false : true;\n  /// Object used by cursorLoop()\n  let obj = {\n    counter: 0,\n    get event() {\n      return this.counter;\n    },\n    source: _store.name,\n    extMode: extMode,\n    origin: origin,\n    query: query,\n    conditionsBlocksArray: conditionsBlocksArray,\n    exitsInFirstTrue: exitsInFirstTrue,\n    logFunction: countLog,\n    cursorFunction: cursorCount,\n    successCallback: successCallback\n  };\n\n  setSharedObj(obj);\n\n  initCursorLoop(_store, errorCallback);\n}\n// Counts all records in the store\nfunction countAll(successCallback, errorCallback) {\n  let origin = 'Store.countAll()';\n  logger(origin + logEnum.begin);\n  let request = _store.count();\n\n  request.onsuccess = function (event) {\n    let message = `${event.target.result} records in store \"${_store.name}\"`;\n    requestSuccessAction(event.target.result, origin, successCallback, message);\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n// Deletes an index\nfunction delIndex(storeName, indexName, successCallback, errorCallback) {\n  let version;\n  let origin = 'Store.delIndex()';\n  logger(origin + logEnum.begin);\n\n  //// Gets the new version\n  //\n  version = db.version;\n  db.close();\n  let newVersion = version + 1;\n\n  //// The change of the database schema only can be performed in the onupgradedneeded event\n  //// so a new version number is needed to trigger that event.\n  //\n  let request = window.indexedDB.open(dbName, newVersion);\n\n  request.onupgradeneeded = function (event) {\n    let _db = event.target.result;\n    setDb(_db);\n    let _store = null;\n\n    let upgradeTransaction = event.target.transaction;\n\n    //// Gets store\n    try {\n      _store = upgradeTransaction.objectStore(storeName);\n    } catch (e) {\n      requestErrorAction(origin, e, errorCallback);\n      return;\n    }\n\n    _store.deleteIndex(indexName);\n  };\n\n  request.onsuccess = function (event) {\n    requestSuccessAction(\n      event,\n      origin,\n      successCallback,\n      `Index \"${indexName}\" deleted from object store \"${storeName}\"`\n    );\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n// Apply a function (aggregatefn) to the values of a property.\nfunction getaggregateFunction(\n  property,\n  aggregatefn,\n  successCallback = voidFn,\n  origin,\n  { query, errorCallback = voidFn }\n) {\n  logger(origin + logEnum.begin);\n\n  var commonArgs = {\n    origin: origin,\n    property: property,\n    aggregatefn: aggregatefn,\n    successCallback: successCallback,\n    errorCallback: errorCallback\n  };\n\n  if (!query) getaggregateFunctionA(commonArgs);\n  else getAggregateFunctionB(query, commonArgs);\n}\nfunction getaggregateFunctionA({\n  origin,\n  property,\n  aggregatefn,\n  successCallback,\n  errorCallback\n}) {\n  let actualValue = null;\n  let counter = 0;\n\n  let request = tryOpenCursor(origin, _store, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n\n  request.onsuccess = function (event) {\n    let cursor = event.target.result;\n\n    if (cursor) {\n      if (cursor.value[property]) {\n        counter++;\n        actualValue = aggregatefn(actualValue, cursor.value[property], counter);\n      }\n      cursor.continue();\n    } else {\n      successCallback(actualValue, origin);\n      db.close();\n      logger(`Result of ${origin} on property \"${property}\": ${actualValue}`);\n      done();\n    }\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\nfunction getAggregateFunctionB(\n  query,\n  { origin, property, aggregatefn, successCallback, errorCallback }\n) {\n  if (isKey(query)) {\n    query = _store.keyPath + '=' + query;\n  }\n  let conditionsBlocksArray = qrySys.makeConditionsBlocksArray(query);\n  let extMode = conditionsBlocksArray\n    ? conditionsBlocksArray[0].externalLogOperator\n    : null;\n  let exitsInFirstTrue = extMode == null || extMode == 'and' ? false : true;\n  let obj = {\n    counter: 0,\n    actualValue: null,\n    get event() {\n      return this.actualValue;\n    },\n    property: property,\n    aggregatefn: aggregatefn,\n    extMode: extMode,\n    origin: origin,\n    query: query,\n    conditionsBlocksArray: conditionsBlocksArray,\n    exitsInFirstTrue: exitsInFirstTrue,\n    logFunction: aggregateLog,\n    cursorFunction: cursorAggregate,\n    successCallback: successCallback\n  };\n\n  setSharedObj(obj);\n\n  /// request definition\n  let request = tryOpenCursor(origin, _store, errorCallback); //store.openCursor();\n  if (!request) {\n    checkTasks();\n    return;\n  }\n  request.onsuccess = function (event) {\n    let cursor = event.target.result;\n    cursorLoop(cursor);\n  };\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n// Adds getaggregateFunction() to the task queue\nfunction makeAggregateTask({\n  property,\n  successCallback,\n  aggregatefn,\n  origin,\n  query,\n  errorCallback\n}) {\n  let options = {\n    query: query,\n    errorCallback: errorCallback\n  };\n\n  let args = [property, aggregatefn, successCallback, origin, options];\n\n  tasks.push({ args: args, fn: getaggregateFunction });\n}\n// Updates one or more records\nfunction update(query, objectValues, { successCallback, errorCallback }) {\n  let origin = 'Store.update()';\n  logger(origin + logEnum.begin);\n\n  //// Gets isIndexKeyValue\n  //// If true then is query is a single value (an index key)\n  let isIndexKeyValue = isKey(query);\n\n  if (isIndexKeyValue) {\n    // If query is a single number value then is mofied to be valid to the query system\n    query = _store.keyPath + '=' + query;\n  }\n  let conditionsBlocksArray = qrySys.makeConditionsBlocksArray(query);\n\n  var extMode = conditionsBlocksArray\n    ? conditionsBlocksArray[0].externalLogOperator\n    : null;\n  var exitsInFirstTrue = extMode == null || extMode == 'and' ? false : true;\n\n  let obj = {\n    counter: 0,\n    keys: Object.keys(objectValues),\n    newObjectValuesSize: Object.keys(objectValues).length,\n    extMode: extMode,\n    source: _store.name,\n    objectValues: objectValues,\n    event: event,\n    origin: origin,\n    query: query,\n    conditionsBlocksArray: conditionsBlocksArray,\n    exitsInFirstTrue: exitsInFirstTrue,\n    logFunction: queryLog,\n    cursorFunction: cursorUpdate,\n    successCallback: successCallback\n  };\n\n  setSharedObj(obj);\n\n  initCursorLoop(_store, errorCallback);\n}\n\nfunction clear({ successCallback, errorCallback }) {\n  let origin = 'Store.clear()';\n  logger(origin + logEnum.begin);\n\n  let request = null;\n  try {\n    request = _store.clear();\n  } catch (e) {\n    requestErrorAction(origin, request.error, errorCallback);\n    return;\n  }\n  request.onsuccess = function (event) {\n    requestSuccessAction(\n      event.target.result,\n      origin,\n      successCallback,\n      `Store \"${_store.name}\" cleared.`\n    );\n  };\n\n  request.onerror = function (event) {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\nfunction initTasks(storeName, rwMode, task) {\n  tasks.push(tkOpen);\n  initStore(storeName, rwMode);\n  tasks.push(task);\n}\n\n/**\n * Constructs a Sixdb Store instance. This constructor is used via Sixdb.openStore() method.\n * @class\n * @param  {string} storeName Name of the object store\n * @return {object}\n */\nexport let Store = function (storeName) {\n  //// Private properties ////////////////////////////\n  let _storeName = storeName;\n\n  /**\n * Gets the name of the store.\n * @method Store#name\n * @return  {string} Name of the store.\n */\n  this.name = function () {\n    return _storeName;\n  };\n\n  //// Public Methods///////////////////\n  /*\n  this.newIndex;\n  this.openIndex;\n  this.delIndex;\n  this.add;\n  this.getAll;\n  this.get;\n  this.del;\n  this.count;\n  this.aggregateFn;\n  this.update;\n  this.clear;\n  */\n};\n\n/**\n * Creates a new index in the object store.\n * @method Store#newIndex\n * @instance\n * @param  {string} indexName Name of the new index.\n * @param  {string} keyPath Name of the property used as key.\n * @param  {object} [options]\n * @param  {boolean} [options.unique] If true, the index will not allow duplicate values for a single key.\n * @param  {function} [options.successCallback] Function called on success. Receives event and origin as parameters.\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n */\nStore.prototype.newIndex = function (\n  indexName,\n  keyPath,\n  { unique, successCallback, errorCallback } = {}\n) {\n  let args = [\n    this.name(),\n    indexName,\n    keyPath,\n    {\n      unique: unique,\n      successCallback: successCallback,\n      errorCallback: errorCallback\n    }\n  ];\n  let task = {\n    args: args,\n    fn: newIndex\n  };\n  tasks.push(tkOpen);\n  tasks.push(task);\n};\n\nStore.prototype.openIndex = function (indexName) {\n  return new Index(this.name(), indexName);\n};\n\n/**\n * Adds one or more records to the object store.\n * @method Store#add\n * @instance\n * @param  {object | object[]} obj A single object or an array of objects wich represents the records.\n * @param  {object} [options]\n * @param  {function} [options.successCallback] Function called on success. Receives event and origin as parameters.\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n * @example\n * var mydb = new Sixdb('myDatabase');\n * \n * // Instantiates the store \"southFactory\"\n * var store = mydb.openStore('southFactory');\n *\n * // Object to insert in the object store\n * //\n * var person = {\n *     name: 'Peter',\n *     age: 32\n * }\n *\n * // Callback function to process a possible error\n * //\n * var myErrorCallback = function(e){\n *     console.log(e);\n * }\n *\n *\n * //\n * // Inserts a new record in the object store.\n * //\n * store.add( person, { errorCallback: myErrorCallback });\n *\n *\n * // Execs all pending tasks.\n * //\n * mydb.execTasks();\n */\nStore.prototype.add = function (obj, { successCallback, errorCallback } = {}) {\n  let args = [obj, { successCallback, errorCallback }];\n  let task = { args: args, fn: addRecord };\n\n  initTasks(this.name(), 'readwrite', task);\n};\n\n/**\n * Gets all records from the object store.\n * @method Store#getAll\n * @instance\n * @param  {function} successCallback Function called on success. Receives event and origin as parameters.\n * @param  {function} [errorCallback] Function to handle errors. Receives an error object as argument.\n * @example\n * const mydb = new Sixdb('myDatabase');\n * \n * // Instantiates the store \"southFactory\"\n * //\n * let store = mydb.openStore('southFactory');\n * \n * // An example of object stored in the object store\n * //\n * let person = {\n *     name: 'Peter',\n *     age: 32,\n *     salary: 1100\n * };\n *\n *\n * //\n * // Callback function to process the result\n * //\n * const myCallback = function(result){\n *\n *     if(Array.isArray(result)){\n *         for(let i = 0, j = result.length; i < j; i++)\n *         console.log(`Name: ${result[i].name} Age: ${result[i].age} Salary: ${result[i].salary}\\n`);\n *     } else {\n *         console.log(`Name: ${result.name} Age: ${result.age} Salary:{result.salary}`);\n *     }\n * };\n *\n *\n * //\n * // Gets all records from the store \"southFactory\"\n * //\n * store.getAll(myCallback);\n *  \n *\n *\n * // Execs all pending tasks\n * mydb.execTasks();\n*/\nStore.prototype.getAll = function (successCallback, errorCallback = voidFn) {\n  let args = [successCallback, errorCallback];\n  let task = {\n    args: args,\n    fn: getAll\n  };\n\n  initTasks(this.name(), 'readonly', task);\n};\n\n/**\n * Gets one or more records from store using a query.\n * @method Store#get\n * @instance\n * @param  {query} query The query to select the records.\n * @param  {function} successCallback Function called on success. Receives event and origin as parameters.\n * @param  {function} [errorCallback] Function to handle errors. Receives an error object as argument.\n * @example\n * // An example of object stored in the object store\n * //\n * let person = {\n *     name: 'Peter',\n *     age: 32,\n *     salary: 1100\n * };\n * \n * const mydb = new Sixdb('myDatabase');\n * \n * // Instantiates the store \"southFactory\"\n * //\n * let store = mydb.openStore('southFactory');\n * \n * // Gets all records with salary > 1200 and age < 40\n * //\n * store.get('salary > 1200 & age < 40', mySuccesCallback);\n * \n * mydb.execTasks();\n * \n */\nStore.prototype.get = function (query, successCallback, errorCallback = voidFn) {\n  let args = [query, successCallback, errorCallback];\n  let task = {\n    args: args,\n    fn: get\n  };\n\n  initTasks(this.name(), 'readonly', task);\n};\n\n/**\n * Deletes one or more records from the store using a query.\n * @method Store#del\n * @instance\n * @param  {query} query \n * @param  {object} [options]\n * @param  {function} [options.successCallback] Function called on success. Receives event and origin as parameters.\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n */\nStore.prototype.del = function (\n  query,\n  { successCallback = voidFn, errorCallback = voidFn } = {}\n) {\n  let args = [query, successCallback, errorCallback];\n  let task = {\n    args: args,\n    fn: del\n  };\n\n  initTasks(this.name(), 'readwrite', task);\n};\n\n/**\n * Counts the records in the store.\n * @method Store#count\n * @instance\n * @param  {function} successCallback Function called on success. Receives result (number), origin and query as parameters.\n * @param  {object} [options] \n * @param  {query} [options.query] The query used to select the records to count.Array\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n */\nStore.prototype.count = function (\n  successCallback,\n  { query, errorCallback = voidFn } = {}\n) {\n  var args = [query, successCallback, errorCallback];\n  var task = {\n    args: args,\n    fn: count\n  };\n\n  initTasks(this.name(), 'readonly', task);\n};\n\n/**\n * Deletes an Index from the store.\n * @method Store#delIndex\n * @instance\n * @param  {string} indexName Name of the index.\n * @param  {object} [options] \n * @param  {function} [options.successCallback] Function called on success. Receives event and origin as parameters.\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n */\nStore.prototype.delIndex = function (\n  indexName,\n  { successCallback = voidFn, errorCallback = voidFn } = {}\n) {\n  let args = [this.name(), indexName, successCallback, errorCallback];\n  let task = {\n    args: args,\n    fn: delIndex\n  };\n\n  tasks.push(tkOpen);\n  tasks.push(task);\n};\n\n/**\n * Iterates the store by applying a function to each record in a specified property.\n * @method Store#aggregateFn\n * @instance\n * @param  {string} property Represents the column to apply the aggregate function.\n * @param  {aggregateFunction} aggregatefn Function applied over the records. \n * @param  {function} successCallback Function called on success. Receives result, origin and query as parameters.\n * @param  {object} [options]\n * @param  {query} [options.query] The query used to select records.errorCallback.\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n * @example\n * // An example of object stored in the object store\n * //\n * let person = {\n *     name: 'Peter',\n *     age: 32,\n *     salary: 1100\n * };\n * \n * const mydb = new Sixdb('myDatabase');\n * \n * // Instantiates the store \"southFactory\"\n * //\n * let store = mydb.openStore('southFactory');\n * \n * // Sends to mySuccesCallback the average age of employees with salary highter than 1500\n * //\n * store.aggregateFn('age', mydb.aggregateFuncs.avg, mySuccesCallback, {query: 'salary > 1500'});\n * \n * mydb.execTasks();\n */\nStore.prototype.aggregateFn = function (\n  property,\n  aggregatefn,\n  successCallback,\n  { query, errorCallback } = {}\n) {\n  var origin = 'Store.aggregateFn()';\n  var args = {\n    property: property,\n    successCallback: successCallback,\n    aggregatefn: aggregatefn,\n    origin: origin,\n    query: query,\n    errorCallback: errorCallback\n  };\n\n  tasks.push(tkOpen);\n  initStore(this.name(), 'readonly');\n  makeAggregateTask(args);\n};\n\n/**\n * Updates one or more records in the store.\n * @method Store#update\n * @instance\n * @param  {query} query The query used to select the records to update.\n * @param  {object} objectValues Object wich contains the properties with the new values.<br>\n * Example: {property1: newValue1, property4: newValue4}<br>\n * The value can be a function that receives the old value and returns a new value:<br>\n * Example: {property2: function(oldValue){return oldValue + 100;}}\n * @param  {object} [options]\n * @param  {function} [options.successCallback] Function called on success. Receives event and origin as parameters.\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n * @example\n * // An example of object stored in the object store\n * //\n * let person = {\n *     name: 'Peter',\n *     age: 32,\n *     salary: 1100\n * };\n * \n * const mydb = new Sixdb('myDatabase');\n * \n * // Instantiates the store \"southFactory\"\n * //\n * let store = mydb.openStore('southFactory');\n * \n * // Updates salary of record with primary key 4 (only in the case that object store has autoincrement primary key)\n * //\n * store.update(4, {salary: 1200});\n * \n * // Updates salary and age of Peter\n * //\n * store.update('name = Peter', {age: 33, salary: 1150});\n * \n * // Increases salary of employees with age > 40 by 100 using a function\n * //\n * store.update(\n *     'age > 40', \n *     {\n *         salary: function(oldSalary){ return oldSalary + 100;} \n *     }\n * );\n * \n * mydb.execTasks();\n */\nStore.prototype.update = function (\n  query,\n  objectValues,\n  { successCallback = voidFn, errorCallback = voidFn } = {}\n) {\n  let options = { successCallback, errorCallback };\n  let args = [query, objectValues, options];\n  let task = {\n    args: args,\n    fn: update\n  };\n\n  initTasks(this.name(), 'readwrite', task);\n};\n\n/**\n * Deletes all records in the object store.\n * @method Store#clear\n * @instance\n * @param  {object} options\n * @param  {function} [options.successCallback] Function called on success. Receives event and origin as parameters.\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument. \n * @return {void}\n */\nStore.prototype.clear = function ({ successCallback = voidFn, errorCallback = voidFn }) {\n  let options = { successCallback, errorCallback };\n  let args = [options];\n  let task = {\n    args: args,\n    fn: clear\n  };\n\n  initTasks(this.name(), 'readwrite', task);\n};\n","import {\n  _qrySys,\n  aggregateLog,\n  checkTasks,\n  countLog,\n  cursorAggregate,\n  cursorCount,\n  cursorGetRecords,\n  cursorLoop,\n  db,\n  done,\n  initCursorLoop,\n  isKey,\n  lastErrorObj,\n  logEnum,\n  logger,\n  makeErrorObject,\n  queryLog,\n  requestErrorAction,\n  requestSuccessAction,\n  setSharedObj,\n  tasks,\n  tkOpen,\n  tryGetAll,\n  tryGetByKey,\n  tryOpenCursor,\n  voidFn,\n} from './index.js';\n\n//// Private variables //////////////////////////////\nlet _index = null;\nlet qrySys = _qrySys;\n\nfunction setIndex(storeName, indexName, rwMode) {\n  _index = null;\n  let origin = 'initIndex()';\n  try {\n    let objectStore = db.transaction(storeName, rwMode).objectStore(storeName);\n    _index = objectStore.index(indexName);\n  } catch (e) {\n    makeErrorObject(origin, e);\n    logger(lastErrorObj, true);\n  }\n  done();\n}\n\n// Adds setIndex to the task queue\nfunction initIndex(storeName, indexName, rwMode) {\n  let args = [storeName, indexName, rwMode];\n  let task = {\n    args: args,\n    fn: setIndex\n  };\n\n  tasks.push(task);\n}\n\n// Gets all records from a store\nfunction getAll(successCallback, errorCallback) {\n  let origin = 'Index.getAll()';\n  logger(origin + logEnum.begin);\n\n  let request = tryGetAll(origin, _index, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n\n  request.onsuccess = function (event) {\n    requestSuccessAction(\n      event.target.result,\n      origin,\n      successCallback,\n      `All records returned from index \"${_index.name}\"`\n    );\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\n// Gets records filtered by a query\nfunction get(query, successCallback, errorCallback) {\n  let origin = 'Index.get()';\n  logger(origin + logEnum.begin);\n  if (isKey(query)) {\n    getBykey(query, successCallback, errorCallback);\n    return;\n  }\n  let resultFiltered = [];\n  let conditionsBlocksArray = qrySys.makeConditionsBlocksArray(query);\n\n  let extMode = conditionsBlocksArray\n    ? conditionsBlocksArray[0].externalLogOperator\n    : null;\n\n  let exitsInFirstTrue = extMode == null || extMode == 'and' ? false : true;\n  let obj = {\n    counter: 0,\n    source: _index.name,\n    extMode: extMode,\n    event: resultFiltered,\n    resultFiltered: resultFiltered,\n    origin: origin,\n    query: query,\n    conditionsBlocksArray: conditionsBlocksArray,\n    exitsInFirstTrue: exitsInFirstTrue,\n    logFunction: queryLog,\n    cursorFunction: cursorGetRecords,\n    successCallback: successCallback\n  };\n\n  setSharedObj(obj);\n\n  let request = tryOpenCursor(origin, _index, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n\n  request.onsuccess = function (event) {\n    let cursor = event.target.result;\n    cursorLoop(cursor);\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\n// Gets records with key as query\nfunction getBykey(query, successCallback, errorCallback) {\n  let origin = 'Index.getByKey()';\n  logger(origin + logEnum.begin);\n\n  let request = tryGetByKey(origin, _index, query, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n\n  request.onsuccess = function (event) {\n    successCallback(event.target.result, origin, query);\n    db.close();\n    logger(`Records with key \"${query}\" returned from index \"${_index.name}\"`);\n    done();\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\n// Counts records filtered by a query\nfunction count(query, successCallback, errorCallback) {\n  let origin = 'Index.count()';\n  logger(origin + logEnum.begin);\n\n  if (!query) {\n    countAll(successCallback, errorCallback);\n    return;\n  }\n\n  let conditionsBlocksArray = qrySys.makeConditionsBlocksArray(query);\n  let extMode = conditionsBlocksArray\n    ? conditionsBlocksArray[0].externalLogOperator\n    : null;\n  let exitsInFirstTrue = extMode == null || extMode == 'and' ? false : true;\n  /// Object used by cursorLoop()\n  let obj = {\n    counter: 0,\n    get event() {\n      return this.counter;\n    },\n    source: _index.name,\n    extMode: extMode,\n    origin: origin,\n    query: query,\n    conditionsBlocksArray: conditionsBlocksArray,\n    exitsInFirstTrue: exitsInFirstTrue,\n    logFunction: countLog,\n    cursorFunction: cursorCount,\n    successCallback: successCallback\n  };\n\n  setSharedObj(obj);\n\n  initCursorLoop(_index, errorCallback);\n}\n\n// Counts all records in the index\nfunction countAll(successCallback, errorCallback) {\n  let origin = 'Index.countAll()';\n  logger(origin + logEnum.begin);\n  let request = _index.count();\n\n  request.onsuccess = function (event) {\n    let message = `${event.target.result} records in index \"${_index.name}\"`;\n    requestSuccessAction(event.target.result, origin, successCallback, message);\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\n// Apply a function (aggregatefn) to the values of a property.\nfunction getaggregateFunction(\n  property,\n  aggregatefn,\n  successCallback = voidFn,\n  origin,\n  { query, errorCallback = voidFn }\n) {\n  logger(origin + logEnum.begin);\n\n  var commonArgs = {\n    origin: origin,\n    property: property,\n    aggregatefn: aggregatefn,\n    successCallback: successCallback,\n    errorCallback: errorCallback\n  };\n\n  if (!query) getaggregateFunctionA(commonArgs);\n  else getAggregateFunctionB(query, commonArgs);\n}\nfunction getaggregateFunctionA({\n  origin,\n  property,\n  aggregatefn,\n  successCallback,\n  errorCallback\n}) {\n  let actualValue = null;\n  let counter = 0;\n\n  let request = tryOpenCursor(origin, _index, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n\n  request.onsuccess = function (event) {\n    let cursor = event.target.result;\n\n    if (cursor) {\n      if (cursor.value[property]) {\n        counter++;\n        actualValue = aggregatefn(actualValue, cursor.value[property], counter);\n      }\n      cursor.continue();\n    } else {\n      successCallback(actualValue, origin);\n      db.close();\n      logger(`Result of ${origin} on property \"${property}\": ${actualValue}`);\n      done();\n    }\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\nfunction getAggregateFunctionB(\n  query,\n  { origin, property, aggregatefn, successCallback, errorCallback }\n) {\n  if (isKey(query)) {\n    query = _index.keyPath + '=' + query;\n  }\n  let conditionsBlocksArray = qrySys.makeConditionsBlocksArray(query);\n  let extMode = conditionsBlocksArray\n    ? conditionsBlocksArray[0].externalLogOperator\n    : null;\n  let exitsInFirstTrue = extMode == null || extMode == 'and' ? false : true;\n  let obj = {\n    counter: 0,\n    actualValue: null,\n    get event() {\n      return this.actualValue;\n    },\n    property: property,\n    aggregatefn: aggregatefn,\n    extMode: extMode,\n    origin: origin,\n    query: query,\n    conditionsBlocksArray: conditionsBlocksArray,\n    exitsInFirstTrue: exitsInFirstTrue,\n    logFunction: aggregateLog,\n    cursorFunction: cursorAggregate,\n    successCallback: successCallback\n  };\n\n  setSharedObj(obj);\n\n  /// request definition\n  let request = tryOpenCursor(origin, _index, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n  request.onsuccess = function (event) {\n    let cursor = event.target.result;\n    cursorLoop(cursor);\n  };\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\n// Adds getaggregateFunction() to the task queue\nfunction makeAggregateTask({\n  property,\n  successCallback,\n  aggregatefn,\n  origin,\n  query,\n  errorCallback\n}) {\n  let options = {\n    query: query,\n    errorCallback: errorCallback\n  };\n\n  let args = [property, aggregatefn, successCallback, origin, options];\n\n  tasks.push({ args: args, fn: getaggregateFunction });\n}\n\nfunction initTasks(storeName, indexName, task) {\n  tasks.push(tkOpen);\n  initIndex(storeName, indexName, 'readonly');\n  tasks.push(task);\n}\n\n/**\n * Constructs a Sixdb Index instance. This constructor is used via Store.openStore() method.\n * @class\n * @param  {string} storeName Name of the parent store.\n * @param  {string} indexName Name of the index.\n * @return {object}\n */\nexport let Index = function (storeName, indexName) {\n  let _indexName = indexName;\n  let _storeName = storeName;\n\n  /**\n   * Gets the name of the index.\n   * @method Index#name\n   * @return  {string} Name of the index.\n   */\n  this.name = function () {\n    return _indexName;\n  };\n\n  /**\n   * Gets the name of the parent store.\n   * @method Index#storeName\n   * @return  {string} Name of the parent store.\n   */\n  this.storeName = function () {\n    return _storeName;\n  };\n\n  //// Public methods /////////////////////////////////////\n  /*\n  this.getAll;\n  this.get;\n  this.count;\n  this.aggregateFn;\n  */\n};\n\n/**\n * Gets all records from the index.\n * @method Index#getAll\n * @instance\n * @param  {function} successCallback Function called on success. Receives event and origin as parameters.\n * @param  {function} [errorCallback] Function to handle errors. Receives an error object as argument.\n * @example\n * const mydb = new Sixdb('myDatabase');\n * \n * // Instantiates the store \"southFactory\"\n * //\n * let store = mydb.openStore('southFactory');\n * \n * // Instantiates the index \"Names\"\n * //\n * let index = store.openIndex('Names');\n * \n * // An example of object stored in the object store\n * //\n * let person = {\n *     name: 'Peter',\n *     age: 32,\n *     salary: 1100\n * };\n *\n *\n * //\n * // Callback function to process the result\n * //\n * const myCallback = function(result){\n *\n *     if(Array.isArray(result)){\n *         for(let i = 0, j = result.length; i < j; i++)\n *         console.log(`Name: ${result[i].name} Age: ${result[i].age} Salary: ${result[i].salary}\\n`);\n *     } else {\n *         console.log(`Name: ${result.name} Age: ${result.age} Salary:{result.salary}`);\n *     }\n * };\n *\n *\n * //\n * // Gets all records from the index \"Names\" in store \"southFactory\"\n * //\n * index.getAll(myCallback);\n *  \n *\n *\n * // Execs all pending tasks\n * mydb.execTasks();\n*/\nIndex.prototype.getAll = function (successCallback, errorCallback = voidFn) {\n  let args = [successCallback, errorCallback];\n  let task = {\n    args: args,\n    fn: getAll\n  };\n\n  initTasks(this.storeName(), this.name(), task);\n};\n\n/**\n * Gets one or more records from an index using a query.\n * @method Index#get\n * @instance\n * @param  {query} query The query to select the records.\n * @param  {function} successCallback Function called on success. Receives event and origin as parameters.\n * @param  {function} [errorCallback] Function to handle errors. Receives an error object as argument.\n * @example\n * // An example of object stored in the object store\n * //\n * let person = {\n *     name: 'Peter',\n *     age: 32,\n *     salary: 1100\n * };\n * \n * const mydb = new Sixdb('myDatabase');\n * \n * // Instantiates the store \"southFactory\"\n * //\n * let store = mydb.openStore('southFactory');\n * \n * // Instantiates the index \"Names\"\n * //\n * let index = store.openIndex('Names');\n * \n * // Gets all records with salary > 1200 and age < 40 in index \"Names\"\n * //\n * index.get('salary > 1200 & age < 40', mySuccesCallback);\n * \n * mydb.execTasks();\n * \n */\nIndex.prototype.get = function (query, successCallback, errorCallback = voidFn) {\n  let args = [query, successCallback, errorCallback];\n  let task = {\n    args: args,\n    fn: get\n  };\n\n  initTasks(this.storeName(), this.name(), task);\n};\n\n/**\n * Counts the records in an index.\n * @method Index#count\n * @instance\n * @param  {function} successCallback Function called on success. Receives result (number), origin and query as parameters.\n * @param  {object} [options] \n * @param  {query} [options.query] The query used to select the records to count.Array\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n */\nIndex.prototype.count = function (\n  successCallback,\n  { query, errorCallback = voidFn } = {}\n) {\n  let args = [query, successCallback, errorCallback];\n  let task = {\n    args: args,\n    fn: count\n  };\n\n  initTasks(this.storeName(), this.name(), task);\n};\n\n/**\n * Iterates the index by applying a function to each record in a specified property.\n * @method Index#aggregateFn\n * @instance\n * @param  {string} property Represents the column to apply the aggregate function.\n * @param  {aggregateFunction} aggregatefn Function applied over the records. \n * @param  {function} successCallback Function called on success. Receives result, origin and query as parameters.\n * @param  {object} [options]\n * @param  {query} [options.query] The query used to select records.errorCallback.\n * @param  {function} [options.errorCallback] Function to handle errors. Receives an error object as argument.\n * @example\n * // An example of object stored in the object store\n * //\n * let person = {\n *     name: 'Peter',\n *     age: 32,\n *     salary: 1100\n * };\n * \n * const mydb = new Sixdb('myDatabase');\n * \n * // Instantiates the store \"southFactory\"\n * //\n * let store = mydb.openStore('southFactory');\n * \n * // Instantiates the index \"Names\"\n * //\n * let index = store.openIndex('Names');\n * \n * // Sends to mySuccesCallback the average age of employees with salary highter than 1500\n * //\n * index.aggregateFn('age', mydb.aggregateFuncs.avg, mySuccesCallback, {query: 'salary > 1500'});\n * \n * mydb.execTasks();\n */\nIndex.prototype.aggregateFn = function (\n  property,\n  aggregatefn,\n  successCallback,\n  { query, errorCallback } = {}\n) {\n  let origin = 'Index.aggregateFn()';\n  let args = {\n    property: property,\n    successCallback: successCallback,\n    aggregatefn: aggregatefn,\n    origin: origin,\n    query: query,\n    errorCallback: errorCallback\n  };\n\n  tasks.push(tkOpen);\n  initIndex(this.storeName(), this.name(), 'readonly');\n  makeAggregateTask(args);\n};\n","export let lastErrorObj = {};\n\nexport function makeErrorObject(origin, domException) {\n  let errorObj = {};\n  if (domException) {\n    errorObj.type = domException.name;\n    errorObj.origin = origin;\n    errorObj.description = domException.message;\n  }\n\n  lastErrorObj = errorObj;\n\n  return true;\n}\n","/**\n * @author       Juan Jose Capellan <soycape@hotmail.com>\n * @copyright    2018 Juan Jose Capellan\n * @license      {@link https://github.com/jjcapellan/SIXDB/blob/master/LICENSE | MIT license}\n */\n\nimport {\n  _qrySys,\n  //consoleOff,\n  //customOperator,\n  done,\n  execTasks,\n  logEnum,\n  logger,\n  requestErrorAction,\n  requestSuccessAction,\n  Store,\n  tasks,\n} from './index.js';\n\n\nlet db = null;\n//let consoleOff = false;\nlet dbName;\nconst voidFn = function () {\n  return 0;\n};\n/*export let customOperator = function (value1, value2) {\n  return value1 == value2;\n};*/\n\n// Opens the database and stores the result in db\nfunction openDb() {\n  let request = window.indexedDB.open(dbName);\n\n  request.onerror = function () {\n    alert('Error. You must allow web app to use indexedDB.');\n  };\n\n  request.onsuccess = function (event) {\n    db = event.target.result;\n    done();\n  };\n}\n\n// Predefined task to open the actual database\nconst tkOpen = { args: null, fn: openDb };\n\n// Allows other modules modify variable db\nfunction setDb(_db) {\n  db = _db;\n}\n\n// Creates a store in the database\nfunction newStore(\n  storeName,\n  { keyPath, autoIncrement, successCallback, errorCallback } = {}\n) {\n  let version;\n  let origin = 'Sixdb.newStore()';\n  logger(origin + logEnum.begin);\n\n  // If store already exist then returns\n  if (db.objectStoreNames.contains(storeName)) {\n    db.close();\n    logger(`Object store \"${storeName}\" already exists`);\n    done();\n    return;\n  }\n\n  version = db.version;\n  db.close();\n  let newVersion = version + 1;\n  let _store;\n\n  let request = window.indexedDB.open(dbName, newVersion);\n\n  request.onupgradeneeded = function (event) {\n    db = event.target.result;\n\n    try {\n      _store = db.createObjectStore(storeName, {\n        keyPath: keyPath,\n        autoIncrement: autoIncrement\n      });\n    } catch (e) {\n      requestErrorAction(origin, e, errorCallback);\n      return;\n    }\n\n    _store.onerror = function (event) {\n      requestErrorAction(origin, event.target.error, errorCallback);\n    };\n  };\n\n  request.onsuccess = function (event) {\n    requestSuccessAction(\n      event,\n      origin,\n      successCallback,\n      `New object store \"${storeName}\" created`\n    );\n  };\n}\n\nfunction delStore(storeName, { successCallback, errorCallback }) {\n  let origin = 'Sixdb.delStore()';\n  logger(origin + logEnum.begin);\n\n  //// Gets the new version\n  //\n  let version = db.version;\n  db.close();\n  let newVersion = version + 1;\n\n  //// The change of the database schema only can be performed in the onupgradedneeded event\n  //// so a new version number is needed to trigger that event.\n  //\n  let request = window.indexedDB.open(dbName, newVersion);\n\n  request.onupgradeneeded = function (event) {\n    db = event.target.result;\n    db.deleteObjectStore(storeName);\n  };\n\n  request.onsuccess = function (event) {\n    requestSuccessAction(\n      event,\n      origin,\n      successCallback,\n      `Object store \"${storeName}\" deleted`\n    );\n  };\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n\nfunction delDB({ successCallback, errorCallback }) {\n  let origin = 'Sixdb.destroy()';\n  logger(origin + logEnum.begin);\n\n  let request = window.indexedDB.deleteDatabase(dbName);\n\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n\n  request.onsuccess = function (event) {\n    successCallback(event, origin);\n    logger(`Database \"${dbName}\" deleted`);\n    done();\n  };\n}\n\n// Join operation. (ON store1.primaryKey = store2.index.keyPath)\nfunction join({ store1Name, store2Name, indexName, succesCallback, errorCallback }) {\n  let joinResult = [];\n  let store1Result = [];\n  let store2Result = [];\n  let origin = 'getJoin()';\n  logger(origin + logEnum.begin);\n  let transaction = db.transaction([store1Name, store2Name]);\n  let indexKeyPath;\n  let posCursor1 = 0;\n  let posCursor2 = 0;\n  let store1ResultLength;\n  let store2ResultLength;\n\n  let store1 = transaction.objectStore(store1Name);\n  let store1KeyPath = store1.keyPath;\n  store1.getAll().onsuccess = function (event) {\n    store1Result = event.target.result;\n    store1ResultLength = store1Result.length;\n\n    let store2 = transaction.objectStore(store2Name);\n    let store2Index = store2.index(indexName);\n    store2Index.getAll().onsuccess = function (event) {\n      store2Result = event.target.result;\n      store2ResultLength = store2Result.length;\n      console.log(store2ResultLength);\n      indexKeyPath = store2Index.keyPath;\n      makeJoinResult();\n    };\n  };\n\n  function makeJoinResult() {\n    if (\n      store1Result[posCursor1][store1KeyPath] == store2Result[posCursor2][indexKeyPath]\n    ) {\n      joinResult.push(Object.assign(store2Result[posCursor2], store1Result[posCursor1]));\n      posCursor2++;\n    } else {\n      posCursor1++;\n    }\n\n    if (posCursor1 == store1ResultLength || posCursor2 == store2ResultLength) {\n      requestSuccessAction(\n        joinResult,\n        origin,\n        successCallback,\n        'Join operation completed'\n      );\n    } else {\n      makeJoinResult();\n    }\n  }\n}\n\n/**\n * Constructs a Sixdb instance.\n * @class\n * @param  {string} _dbName Name of the database \n */\nwindow.Sixdb = function (_dbName) {\n  dbName = _dbName;\n\n  // Query system from qrySys.js\n  let qrySys = _qrySys;\n\n  // Creates or opens the database\n  function newDB(errorCallback = voidFn) {\n    let request = window.indexedDB.open(dbName);\n    let origin = 'Sixdb.newDB()';\n    logger(origin + logEnum.begin);\n\n    // Boolean: Database doesn't exist\n    let noDb = false;\n\n    // if onupgradeneeded means is a new database\n    request.onupgradeneeded = function () {\n      noDb = true;\n    };\n\n    request.onsuccess = function (event) {\n      let db = event.target.result;\n      db.close();\n      if (noDb) {\n        logger(`Database \"${dbName}\" created`);\n      } else {\n        logger(`Database \"${dbName}\" already exists`);\n      }\n      done();\n    };\n  }\n\n  // Adds newDB function to the task queue\n  function addDB(errorCallback) {\n    let args = [errorCallback];\n    let task = {\n      args: args,\n      fn: newDB\n    };\n    tasks.push(task);\n  }\n\n  //// public functions declaration /////////////////\n  this.name;\n  this.setConsoleOff;\n  this.customTask;\n  this.aggregateFuncs;\n  this.execTasks;\n  this.setCustomOperator;\n  this.newStore;\n  this.openStore;\n  this.delStore;\n  this.destroy;\n\n  //// Initialization ///////////////////////////////\n  qrySys.init();\n  addDB();\n  execTasks();\n};\n\n/**\n * Gets the database name.\n * @method window.Sixdb#name\n * @instance\n * @return Name of the database\n */\nSixdb.prototype.name = function () {\n  return dbName;\n};\n\n/**\n * Sets the consoleOff value.\n * @param  {boolean} _consoleOff If true, the console output is off and only errors appear in console.\n */\nSixdb.prototype.setConsoleOff = function (_consoleOff) {\n  consoleOff = _consoleOff;\n};\n\n/**\n * Add a specific function to the Sixdb task queue.\n * @method window.Sixdb#customTask\n * @instance\n * @param  {function} fn Our custom function that we want to add to the task queue.\n * @param  {object} context Usually the keyword \"this\"\n * @param  {...any} args Arguments for the function.\n * @example\n * var mydb = new Sixdb('companyDB');\n * \n * // Creates new store\n * mydb.newStore('southFactory');\n * \n * // Opens the store in a variable\n * var store = mydb.openStore('southFactory');\n *\n *\n * // Inserts one record in \"southFactory\" object store.\n * //\n * store.add(\n *    {ID: 1, name: 'Peter', department: 'manufacturing', age: 32, salary: 1200}\n * );\n *\n *\n * //\n * // To add an own function to the task queue, the method  customTask() of the Sixdb object is used\n * //\n * //     customTask( fn, context, args)\n * //\n * // This task is executed after the previous insertion task and before the next reading task.\n * //\n * mydb.customTask(\n *    function(m){                                // Custom function\n *        alert(m);\n *    },\n *    this,                                       // Context. Usually \"this\".\n *    'Inserting operation finished !!'           // Arguments of the function. Can be a variable number of arguments.\n * );\n *\n *\n *\n * // Reads all records from \"southFactory\" object store.\n * //\n * store.getAll(mySuccessCallback);\n *\n *\n * // ***** VERY IMPORTANT ****\n * // Once we have introduced the operations that we want to perform on the database,\n * // we must use the function execTasks() to execute them.\n * //\n * mydb.execTasks();\n */\nSixdb.prototype.customTask = function (fn, context, args) {\n  let argsArray = [];\n  if (args) {\n    for (let i = 2, j = arguments.length; i < j; i++) {\n      argsArray[2 - i] = arguments[i];\n    }\n  }\n  let task = { type: 'custom', fn: fn, context: context, args: argsArray };\n\n  tasks.push(task);\n};\n/** \n * Contains predefined aggregate functions to use in aggregateFn method.<br>\n * The method aggregateFn accepts too custom functions.\n * \n * @memberof window.Sixdb\n * @namespace\n*/\nSixdb.prototype.aggregateFuncs = {\n  /**\n   * Sums two values\n   * @param  {string | number} actual Acumulated value\n   * @param  {string | number} selected Selected value\n   * @return {string | number} Returns the sum.\n   */\n  sum(actual, selected) {\n    return actual + selected;\n  },\n\n  /**\n   * Calculates the average value.\n   * @param  {number} actual Acumulated value.\n   * @param  {number} selected Selected value.\n   * @param  {number} counter Number of elements.\n   * @return {number} average value.\n   */\n  avg(actual, selected, counter) {\n    return (actual * (counter - 1) + selected) / counter;\n  },\n\n  /**\n   * Returns the maximum value.\n   * @param  {string | number} actual \n   * @param  {string | number} selected \n   * @return {string | number} The maximum value.\n   */\n  max(actual, selected) {\n    return selected > actual ? selected : actual;\n  },\n\n  /**\n   * Returns the minimum value.\n   * @param  {string | number} actual \n   * @param  {string | number} selected \n   * @param  {number} counter Number of iteration.\n   * @return {string | number} The minimum value.\n   */\n  min(actual, selected, counter) {\n    if (counter == 1) {\n      // First value of actual is null. Without this, min is allways null\n      actual = selected;\n    }\n    return selected < actual && counter > 1 ? selected : actual;\n  }\n};\n\n/**\n   * Sets customOperator. To make the queries we can add to the Sixdb comparison operators our own operator.<br>\n   * This operator will be represented by <b>~~</b>.\n   * @method window.Sixdb#setCustomOperator\n   * @instance\n   * @param  {function} compareFunction Function to compare a property value with a test value.<br>\n   * @example\n   * var mydb = new Sixdb('myDatabase');\n   *\n   * //\n   * // The compare function must have two arguments, property value and test value. If this function triggers\n   * // an error exception, then the query system returns the condition as false.\n   * //\n   * mydb.setCustomOperator(\n   *     function(propertyValue, testValue){\n   *         return (propertyValue.length == testValue.length);\n   *     });\n   *\n   */\nSixdb.prototype.setCustomOperator = function (compareFunction) {\n  if (compareFunction) {\n    if (typeof compareFunction == 'function') {\n      if (compareFunction.length == 2) {\n        customOperator = compareFunction;\n      }\n    }\n  }\n};\n\n/**\n   * Execs pending tasks. The tasks are executed sequentially.\n   * A task does not run until the previous one ends.\n   * <br>This avoids problems arising from the asynchronous nature of the indexedDB api.\n   * @method window.Sixdb#execTask\n   * @instance\n   */\nSixdb.prototype.execTasks = function () {\n  execTasks();\n};\n\n/**\n * Creates a task wich creates a store object in the database.\n * @method window.Sixdb#newStore\n * @instance\n * @param  {string} storeName The store name.\n * @param  {object} [options]\n * @param  {string} [options.keyPath] The key path to be used by the new object store. \n * <br>If empty or not specified, the object store is created without a key path and uses out-of-line keys. \n * <br>You can also pass in an array as a keyPath.\n * @param  {Boolean} [options.autoIncrement] If true, the object store has a key generator. Defaults to false.\n * @param  {function} [options.succesCallback] Function called on success. Receives as parameters event and origin.\n * @param  {function} [options.errorCallback] Optional function to handle errors. Receives an error object as argument.\n */\nSixdb.prototype.newStore = function (\n  storeName,\n  { keyPath, autoIncrement, successCallback, errorCallback } = {}\n) {\n  let args = [\n    storeName,\n    {\n      keyPath: keyPath,\n      autoIncrement: autoIncrement,\n      successCallback: successCallback,\n      errorCallback: errorCallback\n    }\n  ];\n  let task = {\n    args: args,\n    fn: newStore\n  };\n  tasks.push(tkOpen);\n  tasks.push(task);\n};\n\n/**\n * Returns an existing store object ready to use\n * @method window.Sixdb#openStore\n * @instance\n * @param  {string} storeName Name of the store.\n * @return {object}\n */\nSixdb.prototype.openStore = function (storeName) {\n  return new Store(storeName);\n};\n\n/**\n * Deletes an object store.\n * @method window.Sixdb#delStore\n * @instance\n * @param  {string} storeName Name of the object store. \n * @param  {object} options\n * @param  {function} [options.succesCallback] Function called on success. Receives as parameters event and origin.\n * @param  {function} [options.errorCallback] Optional function to handle errors. Receives an error object as argument.\n */\nSixdb.prototype.delStore = function (\n  storeName,\n  { successCallback = voidFn, errorCallback = voidFn } = {}\n) {\n  let options = {\n    successCallback: successCallback,\n    errorCallback: errorCallback\n  };\n  let args = [storeName, options];\n  let task = {\n    args: args,\n    fn: delStore\n  };\n\n  tasks.push(tkOpen);\n  tasks.push(task);\n};\n\n/**\n * The current database is deleted.\n * @method window.Sixdb#destroy\n * @instance\n * @param  {object} options\n * @param  {function} [options.succesCallback] Function called on success. Receives as parameters event and origin.\n * @param  {function} [options.errorCallback] Optional function to handle errors. Receives an error object as argument.\n */\nSixdb.prototype.destroy = function (\n  { successCallback = voidFn, errorCallback = voidFn } = {}\n) {\n  let options = {\n    successCallback: successCallback,\n    errorCallback: errorCallback\n  };\n\n  let args = [options];\n  let task = {\n    args: args,\n    fn: delDB\n  };\n\n  tasks.push(task);\n};\n\n/**\n * Creates a join operation on two stores. Joins those objects where store1.keypath = store2.index.keypath <br>\n * and returns the result to a success callback.\n * @method window.Sixdb#join\n * @instance\n * @param  {object} options\n * @param  {string} options.store1Name Name of the store with a primary unique key\n * @param  {string} options.store2Name Name of the second store\n * @param  {string} options.indexName Name of the second store index\n * @param  {function} options.succesCallback Function called on success. Receives as parameters the join result and origin.\n * @param  {function} [options.errorCallback] Optional function to handle errors. Receives an error object as argument.\n * @example\n * // An example of object stored in store \"Employees\"\n * //\n * let person = {\n *     id: 1,                // <<<<<< keyPath of store1\n *     name: 'Peter',\n *     age: 32,\n *     salary: 1100\n * };\n * // An example of object stored in store \"Productions\"\n * //\n * let report = {\n *     reportId: 5,                \n *     employeeId: 1,        // <<<<<<<<<< keyPath of index \"employeeIds\" in store \"Productions\"\n *     production: 150\n * };\n * \n * const mydb = new Sixdb('myDatabase');\n * \n * mydb.join(\n * {\n * store1Name: 'Employees',\n * store2Name: 'Productions',\n * indexName: 'employeeIds',\n * successCallback: mySuccessCallback\n * }\n * );\n * \n * // The expected results array received by the successCallback contains objects like:\n * // {id:1, name:'Peter, age:32, salary:1100, reportId:5, employeeId:1, production:150}   <<<<<<< id = employeeId\n * \n *  \n * mydb.execTasks();\n */\nSixdb.prototype.join = function ({\n  store1Name,\n  store2Name,\n  indexName,\n  succesCallback,\n  errorCallback = voidFn\n}) {\n  let args = [\n    {\n      store1Name,\n      store2Name,\n      indexName,\n      succesCallback,\n      errorCallback\n    }\n  ];\n\n  let task = {\n    args: args,\n    fn: join\n  };\n\n  tasks.push(tkOpen);\n  tasks.push(task);\n};\n\nexport { /*consoleOff,*/ db, newStore, dbName, tkOpen, setDb, voidFn };\n","import {\n  _qrySys,\n  checkTasks,\n  db,\n  done,\n  lastErrorObj,\n  logger,\n  makeErrorObject,\n  tasks,\n} from './index.js';\n\nconst qrySys = _qrySys;\nlet sharedObj = {};\n\nfunction testCursor(conditionsBlocksArray, exitsInFirst, cursor) {\n  let test = false;\n  let i = 0;\n  let size = conditionsBlocksArray.length;\n  for (i = 0; i < size; i++) {\n    let conditions = conditionsBlocksArray[i].conditionsArray;\n    let intMode = conditionsBlocksArray[i].internalLogOperator;\n    test = qrySys.testConditionBlock(cursor, conditions, intMode);\n    if (test == exitsInFirst) {\n      break;\n    }\n  }\n  return test;\n}\n\nfunction reportCatch(origin, e, errorCallback) {\n  makeErrorObject(origin, e);\n  tasks.shift();\n  db.close();\n  errorCallback(lastErrorObj);\n  logger(lastErrorObj, true);\n}\n\nexport function cursorAggregate(cursor) {\n  if (cursor.value[sharedObj.property]) {\n    sharedObj.counter++;\n    sharedObj.actualValue = sharedObj.aggregatefn(\n      sharedObj.actualValue,\n      cursor.value[sharedObj.property],\n      sharedObj.counter\n    );\n  }\n}\n\nexport function aggregateLog() {\n  logger(\n    `Result of ${sharedObj.origin} on property \"${sharedObj.property}\": ${sharedObj.actualValue}`\n  );\n}\n\nexport function setSharedObj(obj) {\n  sharedObj = obj;\n}\n\nexport function requestSuccessAction(event, origin, successCallback, message) {\n  successCallback(event, origin);\n  db.close();\n  logger(message);\n  done();\n}\n\nexport function requestErrorAction(origin, error, errorCallback) {\n  db.close();\n  makeErrorObject(origin, error);\n  logger(lastErrorObj, true);\n  tasks.shift();\n  errorCallback(lastErrorObj);\n  checkTasks();\n}\n\nexport function tryGetAll(origin, source, errorCallback) {\n  let request = null;\n  try {\n    request = source.getAll();\n  } catch (e) {\n    reportCatch(origin, e, errorCallback);\n    return null;\n  }\n  return request;\n}\n\nexport function tryOpenCursor(origin, source, errorCallback) {\n  let request = null;\n  try {\n    request = source.openCursor();\n  } catch (e) {\n    reportCatch(origin, e, errorCallback);\n    return null;\n  }\n  return request;\n}\n\nexport function cursorLoop(cursor) {\n  if (cursor) {\n    let test = testCursor(\n      sharedObj.conditionsBlocksArray,\n      sharedObj.exitsInFirstTrue,\n      cursor\n    );\n\n    if (test) {\n      sharedObj.cursorFunction(cursor);\n    }\n    cursor.continue();\n  } else {\n    sharedObj.successCallback(sharedObj.event, sharedObj.origin, sharedObj.query);\n    db.close();\n    sharedObj.logFunction();\n    done();\n  }\n}\n\nexport function cursorGetRecords(cursor) {\n  sharedObj.resultFiltered.push(cursor.value);\n  sharedObj.counter++;\n}\n\nexport function cursorDelRecords(cursor) {\n  cursor.delete();\n  sharedObj.counter++;\n}\n\nexport function cursorCount() {\n  sharedObj.counter++;\n}\n\nexport function cursorUpdate(cursor) {\n  let updateData = cursor.value;\n  for (let i = 0, j = sharedObj.newObjectValuesSize; i < j; i++) {\n    // If the new value for the property keys[i] is a function then the new value is function(oldValue)\n    updateData[sharedObj.keys[i]] =\n      typeof sharedObj.objectValues[sharedObj.keys[i]] == 'function'\n        ? sharedObj.objectValues[sharedObj.keys[i]](updateData[sharedObj.keys[i]])\n        : sharedObj.objectValues[sharedObj.keys[i]];\n  }\n\n  cursor.update(updateData);\n  sharedObj.counter++;\n}\n\nexport function countLog() {\n  logger(\n    `Processed query finished: \"${sharedObj.query}\"\\n ${sharedObj.counter} records counted from the query to: \"${sharedObj.source}\"`\n  );\n}\n\nexport function queryLog() {\n  logger(\n    `Processed query: \"${sharedObj.query}\" finished\\n ${sharedObj.counter} records returned from object store \"${sharedObj.source}\"`\n  );\n}\n\nexport function tryGetByKey(origin, source, key, errorCallback) {\n  let request = null;\n  try {\n    request = source.getAll(key);\n  } catch (e) {\n    reportCatch(origin, e, errorCallback);\n    return null;\n  }\n  return request;\n}\n\nexport function isKey(query) {\n  let isKey = false;\n  if (query) {\n    if (typeof query == 'number') {\n      isKey = true;\n    } else {\n      isKey = query.match(qrySys.operatorRgx) ? false : true;\n    }\n  }\n  return isKey;\n}\n\nexport function initCursorLoop(source, errorCallback) {\n  let request = tryOpenCursor(sharedObj.origin, source, errorCallback);\n  if (!request) {\n    checkTasks();\n    return;\n  }\n  request.onsuccess = function (event) {\n    let cursor = event.target.result;\n    cursorLoop(cursor);\n  };\n  request.onerror = function () {\n    requestErrorAction(origin, request.error, errorCallback);\n  };\n}\n","export { _qrySys } from './qrySys.js';\nexport { tasks, done, execTasks, checkTasks } from './taskQueue';\nexport { logEnum, logger } from './logger.js';\nexport { Store } from './sixdbStore';\nexport { Index } from './sixdbIndex';\nexport { makeErrorObject, lastErrorObj } from './errorSys';\nexport { db, dbName, setDb, tkOpen, voidFn, /*customOperator, consoleOff*/ } from './sixdb';\nexport {\n    aggregateLog,\n    countLog,\n    cursorAggregate,\n    cursorCount,\n    cursorDelRecords,\n    cursorGetRecords,\n    cursorLoop,\n    cursorUpdate,\n    initCursorLoop,\n    isKey,\n    queryLog,\n    requestErrorAction,\n    requestSuccessAction,\n    setSharedObj,\n    tryGetAll,\n    tryGetByKey,\n    tryOpenCursor,\n} from './helpers';\n\n\nwindow.consoleOff = false;\nwindow.customOperator = function (value1, value2) {\n    return value1 == value2;\n  };"],"names":["init","this","blockRgx","blockOperatorRgx","operatorRgx","rightOperandRgx","leftOperandRgx","makeConditionsBlocksArray","query","conditionsBlocksArray","match","t","extLogOperator","blocks","pushConditionBlockToArray","deleteLeftParentheses","i","length","size","substr","leftOperands","rightOperands","replace","trim","operators","conditionsArray","push","keyPath","cond","value","internalLogOperator","externalLogOperator","logOperatorsType","_i2","testConditionBlock","cursor","operator","test","testCondition","value1","condition","value2","result","indexOf","customOperator","e","idle","tasks","checkTasks","logger","task","type","logEnum","begin","fn","apply","context","args","done","shift","execTasks","message","isError","consoleOff","console","error","log","_qrySys","setStore","storeName","rwMode","_store","db","transaction","objectStore","makeErrorObject","lastErrorObj","initStore","indexName","_temp","_ref","unique","_ref$successCallback","successCallback","voidFn","_ref$errorCallback","errorCallback","origin","indexNames","contains","requestSuccessAction","version","close","request","window","indexedDB","open","dbName","onupgradeneeded","event","setDb","target","upgradeTransaction","createIndex","requestErrorAction","onsuccess","onerror","addRecord","obj","_ref2","_ref2$successCallback","_ref2$errorCallback","Array","isArray","_ref3","objSize","counter","_loop","add","name","addRecordA","_ref4","addRecordB","getAll","tryGetAll","get","isKey","tryGetByKey","getBykey","qrySys","extMode","setSharedObj","source","resultFiltered","exitsInFirstTrue","logFunction","queryLog","cursorFunction","cursorGetRecords","tryOpenCursor","cursorLoop","delByKey","cursorDelRecords","count","countLog","cursorCount","initCursorLoop","countAll","delIndex","deleteIndex","getaggregateFunction","property","aggregatefn","_ref5","_ref5$errorCallback","_ref7","actualValue","aggregateLog","cursorAggregate","getAggregateFunctionB","commonArgs","_ref6","getaggregateFunctionA","objectValues","_ref9","keys","Object","newObjectValuesSize","cursorUpdate","clear","_ref10","initTasks","tkOpen","Store","_storeName","prototype","newIndex","_ref11","_temp2","openIndex","Index","_ref12","_temp3","del","_temp4","_ref13","_ref13$successCallbac","_ref13$errorCallback","_temp5","_ref15","_temp6","_ref15$successCallbac","_ref15$errorCallback","aggregateFn","_temp7","_ref8","_ref16","update","_temp8","_ref17","_ref17$successCallbac","_ref18","_ref18$errorCallback","_ref18$successCallbac","_index","setIndex","index","initIndex","_indexName","domException","errorObj","description","exports","alert","_db","autoIncrement","objectStoreNames","createObjectStore","delStore","deleteObjectStore","delDB","deleteDatabase","join","store1Name","store2Name","joinResult","store2Result","indexKeyPath","store1ResultLength","store2ResultLength","posCursor1","store1","store1Result","store1KeyPath","posCursor2","assign","makeJoinResult","store2Index","Sixdb","_dbName","noDb","setConsoleOff","_consoleOff","customTask","argsArray","j","arguments","aggregateFuncs","sum","actual","selected","avg","max","min","setCustomOperator","compareFunction","newStore","openStore","destroy","_ref7$errorCallback","_ref7$successCallback","succesCallback","reportCatch","sharedObj","openCursor","exitsInFirst","testCursor","updateData","key"],"mappings":"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"}