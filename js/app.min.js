var db,clientes,facturas,actualVersion,DBname,qeueObjectStore=[],taskQeue=[],addObjStoreWorking=!1,dbOpened=!1,cliente1={nombre:"Antonio",telefono:"986585254"},cliente2={nombre:"Manolo",telefono:"600124512"},factura1={idcliente:"1",importe:120},factura2={idcliente:"2",importe:320},factura3={idcliente:"1",importe:145},arrayFacturas=[{idcliente:"1",importe:"15"},{idcliente:"2",importe:"460"},{idcliente:"2",importe:"500"}];function isIndexedDBavailable(){var available=!0;return"indexedDB"in window||(console.log("This browser doesn't support IndexedDB"),available=!1),available}function openDB(name,version){var request=window.indexedDB.open(name,version);request.onerror=function(event){alert("Why didn't you allow my web app to use IndexedDB?!")},request.onsuccess=function(event){console.log("succes"),db=event.target.result,actualVersion=db.version,dbOpened=!0},request.onupgradeneeded=function(event){db=event.target.result,actualVersion=db.version,null!=qeueObjectStore[0]&&(db.createObjectStore(qeueObjectStore[0],{keyPath:qeueObjectStore[1],autoIncrement:qeueObjectStore[2]}),console.log("New objectStore created")),dbOpened=!0}}function closeDB(){db.close(),dbOpened=!1}function addObjStore(name,keyPath,autoincrement){var task={type:"newStore",name:name,keyPath:keyPath,autoIncrement:autoincrement};taskQeue.push(task)}function addRecord(objStore,obj){if(!addObjStoreWorking&&dbOpened){var facturasObjectStore=db.transaction(objStore,"readwrite").objectStore(objStore),i,objSize;if(Array.isArray(obj))for(objSize=obj.length,i=0;i<objSize;i++)facturasObjectStore.add(obj[i]);else facturasObjectStore.add(obj),console.log("registro aÃ±adido")}else setTimeout(function(){addRecord(objStore,obj),console.log("addRecord retry")},200)}openDB("test",1),addObjStore("clientes","id",!0),addRecord("clientes",cliente1);